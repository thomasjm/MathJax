/*
 *  /MathJax/jax/output/EditableSVG/jax.js
 *
 *  Copyright (c) 2009-2015 The MathJax Consortium
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

(function(k,e,h,a){var j;var f;var b="http://www.w3.org/2000/svg";var n="http://www.w3.org/1999/xlink";var o=1;var i=2;var l=3;var c=4;a.Augment({config:{styles:{".MathJax_SVG":{display:"inline","font-style":"normal","font-weight":"normal","line-height":"normal","font-size":"100%","font-size-adjust":"none","text-indent":0,"text-align":"left","text-transform":"none","letter-spacing":"normal","word-spacing":"normal","word-wrap":"normal","white-space":"nowrap","float":"none",direction:"ltr","max-width":"none","max-height":"none","min-width":0,"min-height":0,border:0,padding:0,margin:0,outline:"none"},".MathJax_SVG:focus":{},".MathJax_SVG_Display":{position:"relative",display:"block!important","text-indent":0,"max-width":"none","max-height":"none","min-width":0,"min-height":0,width:"100%"},".MathJax_SVG *":{transition:"none","-webkit-transition":"none","-moz-transition":"none","-ms-transition":"none","-o-transition":"none"},".mjx-svg-href":{fill:"blue",stroke:"blue"},".MathJax_SVG_Processing":{visibility:"hidden",position:"absolute",top:0,left:0,width:0,height:0,overflow:"hidden",display:"block!important"},".MathJax_SVG_Processed":{display:"none!important"},".MathJax_SVG_ExBox":{display:"block!important",overflow:"hidden",width:"1px",height:"60ex","min-height":0,"max-height":"none",padding:0,border:0,margin:0},".backslash-mode use":{fill:"gray",stroke:"gray"},".backslash-mode.invalid use":{fill:"#ff0000",stroke:"#ff0000"},".math-cursor.blink":{animation:"blink 1.06s steps(2, start) infinite","-webkit-animation":"blink 1.06s steps(2, start) infinite"},"@keyframes blink":"to {visibility: hidden}","@-webkit-keyframes blink":"to {visibility: hidden}","#MathJax_SVG_Tooltip":{position:"absolute",left:0,top:0,width:"auto",height:"auto",display:"none"}}},hideProcessedMath:true,fontNames:["TeX","STIX","STIX-Web","Asana-Math","Gyre-Termes","Gyre-Pagella","Latin-Modern","Neo-Euler"],Config:function(){this.SUPER(arguments).Config.apply(this,arguments);var r=e.config.menuSettings,q=this.config,p=r.font;if(r.scale){q.scale=r.scale}if(p&&p!=="Auto"){p=p.replace(/(Local|Web|Image)$/i,"");p=p.replace(/([a-z])([A-Z])/,"$1-$2");this.fontInUse=p}else{this.fontInUse=q.font||"TeX"}if(this.fontNames.indexOf(this.fontInUse)<0){this.fontInUse="TeX"}this.fontDir+="/"+this.fontInUse;if(!this.require){this.require=[]}this.require.push(this.fontDir+"/fontdata.js");this.require.push(MathJax.OutputJax.extensionDir+"/MathEvents.js")},preprocessElementJax:function g(p){if(p.type==="texatom"){if(p.data.length!==1){throw Error("Unexpected length in texatom")}g(p.data[0])}else{if(p.type==="mrow"){var q;for(q=0;q<p.data.length;++q){g(p.data[q])}}else{if(p.cursorable||p.type==="math"){var q;for(q=0;q<p.data.length;++q){var t=p.data[q];if(!t){continue}var r=t.type;if(r[0]!=="m"||r==="mrow"){g(t)}else{var s=new j.mrow();s.Append(g(t));p.SetData(q,s)}}}}}return p},highlightBox:function(p,q){d=100;drawLine=function(t,v,s,u){var r=document.createElementNS(b,"line");p.appendChild(r);r.setAttribute("style","stroke:rgb(0,0,255);stroke-width:20");r.setAttribute("x1",t);r.setAttribute("y1",v);r.setAttribute("x2",s);r.setAttribute("y2",u);return r};return[drawLine(q.x,q.y,q.x+d,q.y),drawLine(q.x,q.y,q.x,q.y+d),drawLine(q.x+q.width,q.y,q.x+q.width-d,q.y),drawLine(q.x+q.width,q.y,q.x+q.width,q.y+d),drawLine(q.x,q.y+q.height,q.x,q.y+q.height-d),drawLine(q.x,q.y+q.height,q.x+d,q.y+q.height),drawLine(q.x+q.width,q.y+q.height,q.x+q.width-d,q.y+q.height),drawLine(q.x+q.width,q.y+q.height,q.x+q.width,q.y+q.height-d)]},visualizeJax:function(q,p,s){p.empty();var t=this.highlightBox;var r=function(w,v){var y;var u;if(_.isString(w)){y=v+w+"\n";u=true}else{y=v+(w?w.type:"null")+"\n"}var z=$('<li><pre style="margin: 0;">'+y+"</pre></li>");z.appendTo(p);if(u){return}z.on("click",function(){var B=w.getSVGBBox();var A=w.EditableSVGelem.ownerSVGElement;t(A,B)});if(!w){return}for(var x=0;x<w.data.length;x++){r(w.data[x],v+" ")}};r(q.root||q,"");cursorInfo=s?JSON.stringify({type:s.node.type,position:s.position,mode:s.mode,selectionStart:s.selectionStart?s.selectionStart.node.type:"null",selectionEnd:s.selectionEnd?s.selectionEnd.node.type:"null"}):"(no cursor)";p.prepend("<pre>"+cursorInfo+"</pre>")},getSVGElem:function(q){if(!q){return}var p=q.nodeName==="svg"?q:q.ownerSVGElement;if(!p){console.error("No owner SVG element");return}return p},elemCoordsToScreenCoords:function(r,p,t){var q=this.getSVGElem(r);if(!q){return}var s=q.createSVGPoint();s.x=p;s.y=t;return s.matrixTransform(r.getScreenCTM())},elemCoordsToViewportCoords:function(r,p,t){var q=this.getSVGElem(r);if(!q){return}var s=q.createSVGPoint();s.x=p;s.y=t;return s.matrixTransform(r.getTransformToElement(q))},screenCoordsToElemCoords:function(r,p,t){var q=this.getSVGElem(r);if(!q){return}var s=q.createSVGPoint();s.x=p;s.y=t;return s.matrixTransform(r.getScreenCTM().inverse())},boxContains:function(q,p,r){return q&&q.x<=p&&p<=q.x+q.width&&q.y<=r&&r<=q.y+q.height},nodeContainsScreenPoint:function(r,q,u){var t=r.getBB&&r.getBB();var s=this.screenCoordsToElemCoords(r.EditableSVGelem,q,u);if(!t||!s){return false}return t.x<=s.x&&s.x<=t.x+t.width&&t.y<=s.y&&s.y<=t.y+t.height},Startup:function(){EVENT=MathJax.Extension.MathEvents.Event;TOUCH=MathJax.Extension.MathEvents.Touch;HOVER=MathJax.Extension.MathEvents.Hover;this.ContextMenu=EVENT.ContextMenu;this.Mouseover=HOVER.Mouseover;this.Mouseout=HOVER.Mouseout;this.Mousemove=HOVER.Mousemove;this.hiddenDiv=h.Element("div",{style:{visibility:"hidden",overflow:"hidden",position:"absolute",top:0,height:"1px",width:"auto",padding:0,border:0,margin:0,textAlign:"left",textIndent:0,textTransform:"none",lineHeight:"normal",letterSpacing:"normal",wordSpacing:"normal"}});if(!document.body.firstChild){document.body.appendChild(this.hiddenDiv)}else{document.body.insertBefore(this.hiddenDiv,document.body.firstChild)}this.hiddenDiv=h.addElement(this.hiddenDiv,"div",{id:"MathJax_SVG_Hidden"});var p=h.addElement(this.hiddenDiv,"div",{style:{width:"5in"}});this.pxPerInch=p.offsetWidth/5;this.hiddenDiv.removeChild(p);this.textSVG=this.Element("svg");m.GLYPH.defs=this.addElement(this.addElement(this.hiddenDiv.parentNode,"svg"),"defs",{id:"MathJax_SVG_glyphs"});this.ExSpan=h.Element("span",{style:{position:"absolute","font-size-adjust":"none"}},[["span",{className:"MathJax_SVG_ExBox"}]]);this.linebreakSpan=h.Element("span",null,[["hr",{style:{width:"auto",size:1,padding:0,border:0,margin:0}}]]);return k.Styles(this.config.styles,["InitializeSVG",this])},InitializeSVG:function(){document.body.appendChild(this.ExSpan);document.body.appendChild(this.linebreakSpan);this.defaultEx=this.ExSpan.firstChild.offsetHeight/60;this.defaultWidth=this.linebreakSpan.firstChild.offsetWidth;document.body.removeChild(this.linebreakSpan);document.body.removeChild(this.ExSpan)},preTranslate:function(s){var x=s.jax[this.id],y,v=x.length,D,w,E,r,C,q,B,u,p,A=false,z,F=this.config.linebreaks.automatic,t=this.config.linebreaks.width;if(F){A=(t.match(/^\s*(\d+(\.\d*)?%\s*)?container\s*$/)!=null);if(A){t=t.replace(/\s*container\s*/,"")}else{p=this.defaultWidth}if(t===""){t="100%"}}else{p=100000}for(y=0;y<v;y++){D=x[y];if(!D.parentNode){continue}w=D.previousSibling;if(w&&String(w.className).match(/^MathJax(_SVG)?(_Display)?( MathJax(_SVG)?_Processing)?$/)){w.parentNode.removeChild(w)}q=D.MathJax.elementJax;if(!q){continue}q.SVG={display:(q.root.Get("display")==="block")};E=r=h.Element("span",{style:{"font-size":this.config.scale+"%",display:"inline-block"},className:"MathJax_SVG",id:q.inputID+"-Frame",isMathJax:true,jaxID:this.id,oncontextmenu:EVENT.Menu,onmousedown:EVENT.Mousedown,onmouseover:EVENT.Mouseover,onmouseout:EVENT.Mouseout,onmousemove:EVENT.Mousemove,onclick:EVENT.Click,ondblclick:EVENT.DblClick});if(e.Browser.noContextMenu){E.ontouchstart=TOUCH.start;E.ontouchend=TOUCH.end}if(q.SVG.display){r=h.Element("div",{className:"MathJax_SVG_Display"});r.appendChild(E)}r.className+=" MathJax_SVG_Processing";D.parentNode.insertBefore(r,D);D.parentNode.insertBefore(this.ExSpan.cloneNode(true),D);r.parentNode.insertBefore(this.linebreakSpan.cloneNode(true),r)}for(y=0;y<v;y++){D=x[y];if(!D.parentNode){continue}C=D.previousSibling;r=C.previousSibling;q=D.MathJax.elementJax;if(!q){continue}B=C.firstChild.offsetHeight/60;z=r.previousSibling.firstChild.offsetWidth;if(A){p=z}if(B===0||B==="NaN"){this.hiddenDiv.appendChild(r);q.SVG.isHidden=true;B=this.defaultEx;z=this.defaultWidth;if(A){p=z}}q.SVG.ex=B;q.SVG.em=u=B/a.TeX.x_height*1000;q.SVG.cwidth=z/u*1000;q.SVG.lineWidth=(F?this.length2em(t,1,p/u*1000):a.BIGDIMEN)}for(y=0;y<v;y++){D=x[y];if(!D.parentNode){continue}C=x[y].previousSibling;E=C.previousSibling;q=x[y].MathJax.elementJax;if(!q){continue}if(!q.SVG.isHidden){E=E.previousSibling}E.parentNode.removeChild(E);C.parentNode.removeChild(C)}s.SVGeqn=s.SVGlast=0;s.SVGi=-1;s.SVGchunk=this.config.EqnChunk;s.SVGdelay=false},AddInputHandlers:function(s,r,t){s.cursor=new MathJax.Object.Cursor();s.rerender=q;r.setAttribute("tabindex","0");function q(v){try{a.preprocessElementJax(s).toSVG(r,t,true);s.cursor.refocus()}catch(u){if(u.restart){MathJax.Callback.After([q,v],u.restart);return}throw u}MathJax.Callback(v)()}function p(u){if(s.cursor[u.type]){s.cursor[u.type](u,q)}}r.addEventListener("keydown",p);r.addEventListener("keypress",p);r.addEventListener("mousedown",p);r.addEventListener("blur",p);r.addEventListener("focus",p)},Translate:function(q,u){if(!q.parentNode){return}if(u.SVGdelay){u.SVGdelay=false;e.RestartAfter(MathJax.Callback.Delay(this.config.EqnChunkDelay))}var p=q.MathJax.elementJax,t=this.preprocessElementJax(p.root),r=document.getElementById(p.inputID+"-Frame"),w=(p.SVG.display?(r||{}).parentNode:r),v=(a.config.useFontCache&&!a.config.useGlobalCache);if(!w){return}if(p.root.data.length===1){if(p.root.data[0].type==="mrow"){if(p.root.data[0].data.length===0){p.root.data[0].SetData(0,j.hole())}}}this.em=j.mbase.prototype.em=p.SVG.em;this.ex=p.SVG.ex;this.linebreakWidth=p.SVG.lineWidth;this.cwidth=p.SVG.cwidth;this.mathDiv=w;r.appendChild(this.textSVG);if(v){a.resetGlyphs()}this.initSVG(t,r);t.setTeXclass();try{t.toSVG(r,w)}catch(s){if(s.restart){while(r.firstChild){r.removeChild(r.firstChild)}}if(v){m.GLYPH.n--}throw s}r.removeChild(this.textSVG);this.AddInputHandlers(t,r,w);if(p.SVG.isHidden){q.parentNode.insertBefore(w,q)}w.className=w.className.split(/ /)[0];if(this.hideProcessedMath){w.className+=" MathJax_SVG_Processed";if(q.MathJax.preview){p.SVG.preview=q.MathJax.preview;delete q.MathJax.preview}u.SVGeqn+=(u.i-u.SVGi);u.SVGi=u.i;if(u.SVGeqn>=u.SVGlast+u.SVGchunk){this.postTranslate(u,true);u.SVGchunk=Math.floor(u.SVGchunk*this.config.EqnChunkFactor);u.SVGdelay=true}}},postTranslate:function(v,s){var q=v.jax[this.id];if(!this.hideProcessedMath){return}for(var t=v.SVGlast,p=v.SVGeqn;t<p;t++){var r=q[t];if(r&&r.MathJax.elementJax){r.previousSibling.className=r.previousSibling.className.split(/ /)[0];var u=r.MathJax.elementJax.SVG;if(u.preview){u.preview.innerHTML="";r.MathJax.preview=u.preview;delete u.preview}}}v.SVGlast=v.SVGeqn},resetGlyphs:function(q){if(this.config.useFontCache){var p=m.GLYPH;if(this.config.useGlobalCache){p.defs=document.getElementById("MathJax_SVG_glyphs");p.defs.innerHTML=""}else{p.defs=this.Element("defs");p.n++}p.glyphs={};if(q){p.n=0}}},hashCheck:function(p){if(p&&p.nodeName.toLowerCase()==="g"){do{p=p.parentNode}while(p&&p.firstChild.nodeName!=="svg")}return p},getJaxFromMath:function(p){if(p.parentNode.className==="MathJax_SVG_Display"){p=p.parentNode}do{p=p.nextSibling}while(p&&p.nodeName.toLowerCase()!=="script");return e.getJaxFor(p)},getHoverSpan:function(p,q){q.style.position="relative";return q.firstChild},getHoverBBox:function(p,q,r){var s=EVENT.getBBox(q.parentNode);s.h+=2;s.d-=2;return s},Zoom:function(q,z,y,p,w){z.className="MathJax_SVG";var B=z.appendChild(this.ExSpan.cloneNode(true));var v=B.firstChild.offsetHeight/60;this.em=j.mbase.prototype.em=v/a.TeX.x_height*1000;this.ex=v;this.linebreakWidth=q.SVG.lineWidth;this.cwidth=q.SVG.cwidth;B.parentNode.removeChild(B);z.appendChild(this.textSVG);this.mathDIV=z;this.zoomScale=parseInt(e.config.menuSettings.zscale)/100;var u=q.root.data[0].EditableSVGdata.tw;if(u&&u<this.cwidth){this.cwidth=u}this.idPostfix="-zoom";q.root.toSVG(z,z);this.idPostfix="";this.zoomScale=1;z.removeChild(this.textSVG);var t=z.getElementsByTagName("svg")[0].style;t.marginTop=t.marginRight=t.marginLeft=0;if(t.marginBottom.charAt(0)==="-"){z.style.marginBottom=t.marginBottom.substr(1)}if(this.operaZoomRefresh){setTimeout(function(){z.firstChild.style.border="1px solid transparent"},1)}if(z.offsetWidth<z.firstChild.offsetWidth){z.style.minWidth=z.firstChild.offsetWidth+"px";y.style.minWidth=y.firstChild.offsetWidth+"px"}z.style.position=y.style.position="absolute";var x=z.offsetWidth,s=z.offsetHeight,A=y.offsetHeight,r=y.offsetWidth;z.style.position=y.style.position="";return{Y:-EVENT.getBBox(z).h,mW:r,mH:A,zW:x,zH:s}},initSVG:function(q,p){},Remove:function(p){var q=document.getElementById(p.inputID+"-Frame");if(q){if(p.SVG.display){q=q.parentNode}q.parentNode.removeChild(q)}delete p.SVG},Em:function(p){if(Math.abs(p)<0.0006){return"0em"}return p.toFixed(3).replace(/\.?0+$/,"")+"em"},Ex:function(p){p=Math.round(p/this.TeX.x_height*this.ex)/this.ex;if(Math.abs(p)<0.0006){return"0ex"}return p.toFixed(3).replace(/\.?0+$/,"")+"ex"},Percent:function(p){return(100*p).toFixed(1).replace(/\.?0+$/,"")+"%"},Fixed:function(p,q){if(Math.abs(p)<0.0006){return"0"}return p.toFixed(q||3).replace(/\.?0+$/,"")},length2em:function(u,q,s){if(typeof(u)!=="string"){u=u.toString()}if(u===""){return""}if(u===j.SIZE.NORMAL){return 1000}if(u===j.SIZE.BIG){return 2000}if(u===j.SIZE.SMALL){return 710}if(u==="infinity"){return a.BIGDIMEN}if(u.match(/mathspace$/)){return 1000*a.MATHSPACE[u]}var v=(this.zoomScale||1)/a.em;var r=u.match(/^\s*([-+]?(?:\.\d+|\d+(?:\.\d*)?))?(pt|em|ex|mu|px|pc|in|mm|cm|%)?/);var p=parseFloat(r[1]||"1")*1000,t=r[2];if(s==null){s=1000}if(q==null){q=1}if(t==="em"){return p}if(t==="ex"){return p*a.TeX.x_height/1000}if(t==="%"){return p/100*s/1000}if(t==="px"){return p*v}if(t==="pt"){return p/10}if(t==="pc"){return p*1.2}if(t==="in"){return p*this.pxPerInch*v}if(t==="cm"){return p*this.pxPerInch*v/2.54}if(t==="mm"){return p*this.pxPerInch*v/25.4}if(t==="mu"){return p/18*q}return p*s/1000},thickness2em:function(q,p){var r=a.TeX.rule_thickness;if(q===j.LINETHICKNESS.MEDIUM){return r}if(q===j.LINETHICKNESS.THIN){return 0.67*r}if(q===j.LINETHICKNESS.THICK){return 1.67*r}return this.length2em(q,p,r)},getPadding:function(q){var s={top:0,right:0,bottom:0,left:0};var p=false;for(var t in s){if(s.hasOwnProperty(t)){var r=q["padding"+t.charAt(0).toUpperCase()+t.substr(1)];if(r){s[t]=this.length2em(r);p=true}}}return(p?s:false)},getBorders:function(t){var r={top:0,right:0,bottom:0,left:0},q=false;for(var u in r){if(r.hasOwnProperty(u)){var p="border"+u.charAt(0).toUpperCase()+u.substr(1);var s=t[p+"Style"];if(s&&s!=="none"){q=true;r[u]=this.length2em(t[p+"Width"]);r[u+"Style"]=t[p+"Style"];r[u+"Color"]=t[p+"Color"];if(r[u+"Color"]==="initial"){r[u+"Color"]=""}}else{delete r[u]}}}return(q?r:false)},Element:function(p,q){var r=(typeof(p)==="string"?document.createElementNS(b,p):p);r.isMathJax=true;if(q){for(var s in q){if(q.hasOwnProperty(s)){r.setAttribute(s,q[s].toString())}}}return r},addElement:function(q,p,r){return q.appendChild(this.Element(p,r))},TextNode:h.TextNode,addText:h.addText,ucMatch:h.ucMatch,HandleVariant:function(v,u,E){var y=m.G();var r,A,C,s,D,w,t,q,B,p;if(!v){v=this.FONTDATA.VARIANT[j.VARIANT.NORMAL]}if(v.forceFamily){E=m.TEXT(u,E,v.font);if(v.h!==null){E.h=v.h}if(v.d!==null){E.d=v.d}y.Add(E);E=""}D=v;for(w=0,t=E.length;w<t;w++){v=D;r=E.charCodeAt(w);C=E.charAt(w);if(r>=55296&&r<56319){w++;r=(((r-55296)<<10)+(E.charCodeAt(w)-56320))+65536;if(this.FONTDATA.RemapPlane1){var z=this.FONTDATA.RemapPlane1(r,v);r=z.n;v=z.variant}}else{p=this.FONTDATA.RANGES;for(q=0,B=p.length;q<B;q++){if(p[q].name==="alpha"&&v.noLowerCase){continue}A=v["offset"+p[q].offset];if(A&&r>=p[q].low&&r<=p[q].high){if(p[q].remap&&p[q].remap[r]){r=A+p[q].remap[r]}else{r=r-p[q].low+A;if(p[q].add){r+=p[q].add}}if(v["variant"+p[q].offset]){v=this.FONTDATA.VARIANT[v["variant"+p[q].offset]]}break}}}if(v.remap&&v.remap[r]){r=v.remap[r];if(v.remap.variant){v=this.FONTDATA.VARIANT[v.remap.variant]}}else{if(this.FONTDATA.REMAP[r]&&!v.noRemap){r=this.FONTDATA.REMAP[r]}}if(r instanceof Array){v=this.FONTDATA.VARIANT[r[1]];r=r[0]}if(typeof(r)==="string"){E=r+E.substr(w+1);t=E.length;w=-1;continue}s=this.lookupChar(v,r);C=s[r];if(C){if((C[5]&&C[5].space)||(C[5]===""&&C[0]+C[1]===0)){y.w+=C[2]}else{C=[u,s.id+"-"+r.toString(16).toUpperCase()].concat(C);y.Add(m.GLYPH.apply(m,C),y.w,0)}}else{if(this.FONTDATA.DELIMITERS[r]){C=this.createDelimiter(r,0,1,s);y.Add(C,y.w,(this.FONTDATA.DELIMITERS[r].dir==="V"?C.d:0))}else{if(r<=65535){C=String.fromCharCode(r)}else{A=r-65536;C=String.fromCharCode((A>>10)+55296)+String.fromCharCode((A&1023)+56320)}var x=m.TEXT(u*100/a.config.scale,C,{"font-family":v.defaultFamily||a.config.undefinedFamily,"font-style":(v.italic?"italic":""),"font-weight":(v.bold?"bold":"")});if(v.h!==null){x.h=v.h}if(v.d!==null){x.d=v.d}C=m.G();C.Add(x);y.Add(C,y.w,0);e.signal.Post(["SVG Jax - unknown char",r,v])}}}if(E.length==1&&s.skew&&s.skew[r]){y.skew=s.skew[r]*1000}if(y.element.childNodes.length===1){y.element=y.element.firstChild;y.removeable=false;y.scale=u}return y},lookupChar:function(s,v){var r,p;if(!s.FONTS){var u=this.FONTDATA.FONTS;var t=(s.fonts||this.FONTDATA.VARIANT.normal.fonts);if(!(t instanceof Array)){t=[t]}if(s.fonts!=t){s.fonts=t}s.FONTS=[];for(r=0,p=t.length;r<p;r++){if(u[t[r]]){s.FONTS.push(u[t[r]])}}}for(r=0,p=s.FONTS.length;r<p;r++){var q=s.FONTS[r];if(typeof(q)==="string"){delete s.FONTS;this.loadFont(q)}if(q[v]){return q}else{this.findBlock(q,v)}}return{id:"unknown"}},findBlock:function(q,u){if(q.Ranges){for(var t=0,p=q.Ranges.length;t<p;t++){if(u<q.Ranges[t][0]){return}if(u<=q.Ranges[t][1]){var s=q.Ranges[t][2];for(var r=q.Ranges.length-1;r>=0;r--){if(q.Ranges[r][2]==s){q.Ranges.splice(r,1)}}this.loadFont(q.directory+"/"+s+".js")}}}},loadFont:function(p){e.RestartAfter(k.Require(this.fontDir+"/"+p))},createHole:function(p,r){var q=m.RECT(r,0,p,{fill:"white",stroke:"blue","stroke-width":"20"});return q},createDelimiter:function(p,r,u,s){if(!u){u=1}var w=m.G();if(!p){w.Clean();delete w.element;w.w=w.r=this.TeX.nulldelimiterspace*u;return w}if(!(r instanceof Array)){r=[r,r]}var x=r[1];r=r[0];var q={alias:p};while(q.alias){p=q.alias;q=this.FONTDATA.DELIMITERS[p];if(!q){q={HW:[0,this.FONTDATA.VARIANT[j.VARIANT.NORMAL]]}}}if(q.load){e.RestartAfter(k.Require(this.fontDir+"/fontdata-"+q.load+".js"))}for(var v=0,t=q.HW.length;v<t;v++){if(q.HW[v][0]*u>=r-10-a.config.blacker||(v==t-1&&!q.stretch)){if(q.HW[v][2]){u*=q.HW[v][2]}if(q.HW[v][3]){p=q.HW[v][3]}return this.createChar(u,[p,q.HW[v][1]],s).With({stretched:true})}}if(q.stretch){this["extendDelimiter"+q.dir](w,x,q.stretch,u,s)}return w},createChar:function(w,u,r){var v="",t={fonts:[u[1]],noRemap:true};if(r&&r===j.VARIANT.BOLD){t.fonts=[u[1]+"-bold",u[1]]}if(typeof(u[1])!=="string"){t=u[1]}if(u[0] instanceof Array){for(var s=0,p=u[0].length;s<p;s++){v+=String.fromCharCode(u[0][s])}}else{v=String.fromCharCode(u[0])}if(u[4]){w=w*u[4]}var q=this.HandleVariant(t,w,v);if(u[2]){q.x=u[2]*1000}if(u[3]){q.y=u[3]*1000}if(u[5]){q.h+=u[5]*1000}if(u[6]){q.d+=u[6]*1000}return q},extendDelimiterV:function(w,E,q,t,r){var C=this.createChar(t,(q.top||q.ext),r);var z=this.createChar(t,(q.bot||q.ext),r);var v=C.h+C.d+z.h+z.d;var B=-C.h;w.Add(C,0,B);B-=C.d;if(q.mid){var D=this.createChar(t,q.mid,r);v+=D.h+D.d}if(q.min&&E<v*q.min){E=v*q.min}if(E>v){var p=this.createChar(t,q.ext,r);var u=(q.mid?2:1),A=(E-v)/u,F=(A+100)/(p.h+p.d);while(u-->0){var x=a.Element("g",{transform:"translate("+p.y+","+(B-F*p.h+50+p.y)+") scale(1,"+F+")"});x.appendChild(p.element.cloneNode(false));w.element.appendChild(x);B-=A;if(q.mid&&u){w.Add(D,0,B-D.h);B-=(D.h+D.d)}}}else{if(q.mid){B+=(v-E)/2;w.Add(D,0,B-D.h);B+=-(D.h+D.d)+(v-E)/2}else{B+=(v-E)}}w.Add(z,0,B-z.h);w.Clean();w.scale=t;w.isMultiChar=true},extendDelimiterH:function(z,t,q,v,r){var u=this.createChar(v,(q.left||q.rep),r);var G=this.createChar(v,(q.right||q.rep),r);z.Add(u,-u.l,0);var F=(u.r-u.l)+(G.r-G.l),D=u.r-u.l;if(q.mid){var E=this.createChar(v,q.mid,r);F+=E.w}if(q.min&&t<F*q.min){t=F*q.min}if(t>F){var C=this.createChar(v,q.rep,r),p=q.fuzz||0;var y=(q.mid?2:1),B=(t-F)/y,H=(B+p)/(C.r-C.l);while(y-->0){var A=a.Element("g",{transform:"translate("+(D-p/2-H*C.l+C.x)+","+C.y+") scale("+H+",1)"});A.appendChild(C.element.cloneNode(false));z.element.appendChild(A);D+=B;if(q.mid&&y){z.Add(E,D,0);D+=E.w}}}else{if(q.mid){D-=(F-t)/2;z.Add(E,D,0);D+=E.w-(F-t)/2}else{D-=(F-t)}}z.Add(G,D-G.l,0);z.Clean();z.scale=v;z.isMultiChar=true},MATHSPACE:{veryverythinmathspace:1/18,verythinmathspace:2/18,thinmathspace:3/18,mediummathspace:4/18,thickmathspace:5/18,verythickmathspace:6/18,veryverythickmathspace:7/18,negativeveryverythinmathspace:-1/18,negativeverythinmathspace:-2/18,negativethinmathspace:-3/18,negativemediummathspace:-4/18,negativethickmathspace:-5/18,negativeverythickmathspace:-6/18,negativeveryverythickmathspace:-7/18},TeX:{x_height:430.554,quad:1000,num1:676.508,num2:393.732,num3:443.73,denom1:685.951,denom2:344.841,sup1:412.892,sup2:362.892,sup3:288.888,sub1:150,sub2:247.217,sup_drop:386.108,sub_drop:50,delim1:2390,delim2:1000,axis_height:250,rule_thickness:60,big_op_spacing1:111.111,big_op_spacing2:166.666,big_op_spacing3:200,big_op_spacing4:600,big_op_spacing5:100,scriptspace:100,nulldelimiterspace:120,delimiterfactor:901,delimitershortfall:300,min_rule_thickness:1.25,min_root_space:1.5},BIGDIMEN:10000000,NBSP:"\u00A0"});var m=a.BBOX=MathJax.Object.Subclass({type:"g",removeable:true,Init:function(p){this.h=this.d=-a.BIGDIMEN;this.H=this.D=0;this.w=this.r=0;this.l=a.BIGDIMEN;this.x=this.y=0;this.scale=1;this.n=0;if(this.type){this.element=a.Element(this.type,p)}},With:function(p){return e.Insert(this,p)},Add:function(r,z,w,p,v){if(z){r.x+=z}if(w){r.y+=w}if(r.element){if(r.removeable&&r.element.childNodes.length===1&&r.n===1){var q=r.element.firstChild,t=q.nodeName.toLowerCase();if(t==="use"||t==="rect"){r.element=q;r.scale=r.childScale;var u=r.childX,s=r.childY;r.x+=u;r.y+=s;r.h-=s;r.d+=s;r.H-=s;r.D+=s;r.w-=u;r.r-=u;r.l+=u;r.removeable=false;q.setAttribute("x",Math.floor(r.x/r.scale));q.setAttribute("y",Math.floor(r.y/r.scale))}}if(Math.abs(r.x)<1&&Math.abs(r.y)<1){r.remove=r.removeable}else{t=r.element.nodeName.toLowerCase();if(t==="g"){if(!r.element.firstChild){r.remove=r.removeable}else{r.element.setAttribute("transform","translate("+Math.floor(r.x)+","+Math.floor(r.y)+")")}}else{if(t==="line"||t==="polygon"||t==="path"||t==="a"){r.element.setAttribute("transform","translate("+Math.floor(r.x)+","+Math.floor(r.y)+")")}else{r.element.setAttribute("x",Math.floor(r.x/r.scale));r.element.setAttribute("y",Math.floor(r.y/r.scale))}}}if(r.remove){this.n+=r.n;while(r.element.firstChild){if(v&&this.element.firstChild){this.element.insertBefore(r.element.firstChild,this.element.firstChild)}else{this.element.appendChild(r.element.firstChild)}}}else{if(v){this.element.insertBefore(r.element,this.element.firstChild)}else{this.element.appendChild(r.element)}}delete r.element}if(r.hasIndent){this.hasIndent=r.hasIndent}if(r.tw!=null){this.tw=r.tw}if(r.d-r.y>this.d){this.d=r.d-r.y;if(this.d>this.D){this.D=this.d}}if(r.y+r.h>this.h){this.h=r.y+r.h;if(this.h>this.H){this.H=this.h}}if(r.D-r.y>this.D){this.D=r.D-r.y}if(r.y+r.H>this.H){this.H=r.y+r.H}if(r.x+r.l<this.l){this.l=r.x+r.l}if(r.x+r.r>this.r){this.r=r.x+r.r}if(p||r.x+r.w+(r.X||0)>this.w){this.w=r.x+r.w+(r.X||0)}this.childScale=r.scale;this.childX=r.x;this.childY=r.y;this.n++;return r},Align:function(t,u,s,r,q){s=({left:s,center:(this.w-t.w)/2,right:this.w-t.w-s})[u]||0;var p=this.w;this.Add(t,s+(q||0),r);this.w=p},Clean:function(){if(this.h===-a.BIGDIMEN){this.h=this.d=this.l=0}return this}});m.ROW=m.Subclass({Init:function(){this.SUPER(arguments).Init.call(this);this.svg=[];this.sh=this.sd=0},Check:function(q){var p=q.toSVG();this.svg.push(p);if(q.SVGcanStretch("Vertical")){p.mml=q}if(p.h>this.sh){this.sh=p.h}if(p.d>this.sd){this.sd=p.d}return p},Stretch:function(){for(var s=0,p=this.svg.length;s<p;s++){var q=this.svg[s],r=q.mml;if(r){if(r.forceStretch||r.EditableSVGdata.h!==this.sh||r.EditableSVGdata.d!==this.sd){q=r.SVGstretchV(this.sh,this.sd)}r.EditableSVGdata.HW=this.sh;r.EditableSVGdata.D=this.sd}if(q.ic){this.ic=q.ic}else{delete this.ic}this.Add(q,this.w,0,true)}delete this.svg}});m.RECT=m.Subclass({type:"rect",removeable:false,Init:function(q,s,p,r){if(r==null){r={stroke:"none"}}r.width=Math.floor(p);r.height=Math.floor(q+s);this.SUPER(arguments).Init.call(this,r);this.w=this.r=p;this.h=this.H=q+s;this.d=this.D=this.l=0;this.y=-s}});m.FRAME=m.Subclass({type:"rect",removeable:false,Init:function(s,x,p,r,v,q,u){if(u==null){u={}}u.fill="none";u["stroke-width"]=a.Fixed(r,2);u.width=Math.floor(p-r);u.height=Math.floor(s+x-r);u.transform="translate("+Math.floor(r/2)+","+Math.floor(-x+r/2)+")";if(v==="dashed"){u["stroke-dasharray"]=[Math.floor(6*a.em),Math.floor(6*a.em)].join(" ")}this.SUPER(arguments).Init.call(this,u);this.w=this.r=p;this.h=this.H=s;this.d=this.D=x;this.l=0}});m.HLINE=m.Subclass({type:"line",removeable:false,Init:function(q,s,v,r,u){if(u==null){u={"stroke-linecap":"square"}}if(r&&r!==""){u.stroke=r}u["stroke-width"]=a.Fixed(s,2);u.x1=u.y1=u.y2=Math.floor(s/2);u.x2=Math.floor(q-s/2);if(v==="dashed"){var x=Math.floor(Math.max(0,q-s)/(6*s)),p=Math.floor(Math.max(0,q-s)/(2*x+1));u["stroke-dasharray"]=p+" "+p}if(v==="dotted"){u["stroke-dasharray"]=[1,Math.max(150,Math.floor(2*s))].join(" ");u["stroke-linecap"]="round"}this.SUPER(arguments).Init.call(this,u);this.w=this.r=q;this.l=0;this.h=this.H=s;this.d=this.D=0}});m.VLINE=m.Subclass({type:"line",removeable:false,Init:function(s,r,v,q,u){if(u==null){u={"stroke-linecap":"square"}}if(q&&q!==""){u.stroke=q}u["stroke-width"]=a.Fixed(r,2);u.x1=u.x2=u.y1=Math.floor(r/2);u.y2=Math.floor(s-r/2);if(v==="dashed"){var w=Math.floor(Math.max(0,s-r)/(6*r)),p=Math.floor(Math.max(0,s-r)/(2*w+1));u["stroke-dasharray"]=p+" "+p}if(v==="dotted"){u["stroke-dasharray"]=[1,Math.max(150,Math.floor(2*r))].join(" ");u["stroke-linecap"]="round"}this.SUPER(arguments).Init.call(this,u);this.w=this.r=r;this.l=0;this.h=this.H=s;this.d=this.D=0}});m.TEXT=m.Subclass({type:"text",removeable:false,Init:function(s,r,p){if(!p){p={}}p.stroke="none";if(p["font-style"]===""){delete p["font-style"]}if(p["font-weight"]===""){delete p["font-weight"]}this.SUPER(arguments).Init.call(this,p);a.addText(this.element,r);a.textSVG.appendChild(this.element);var q=this.element.getBBox();a.textSVG.removeChild(this.element);s*=1000/a.em;this.element.setAttribute("transform","scale("+a.Fixed(s)+") matrix(1 0 0 -1 0 0)");this.w=this.r=q.width*s;this.l=0;this.h=this.H=-q.y*s;this.d=this.D=(q.height+q.y)*s}});m.G=m;m.NULL=m.Subclass({Init:function(){this.SUPER(arguments).Init.apply(this,arguments);this.Clean()}});m.GLYPH=m.Subclass({type:"path",removeable:false,Init:function(z,u,C,D,E,A,s,v){var x,F=a.config.blacker,B=m.GLYPH;var q=a.config.useFontCache;var y=(z===1?null:"scale("+a.Fixed(z)+")");if(q&&!a.config.useGlobalCache){u="E"+B.n+"-"+u}if(!q||!B.glyphs[u]){x={"stroke-width":F};if(q){x.id=u}else{if(y){x.transform=y}}x.d=(v?"M"+v+"Z":"");this.SUPER(arguments).Init.call(this,x);if(q){B.defs.appendChild(this.element);B.glyphs[u]=true}}if(q){x={};if(y){x.transform=y}this.element=a.Element("use",x);this.element.setAttributeNS(n,"href","#"+u)}this.h=(C+F)*z;this.d=(D+F)*z;this.w=(E+F/2)*z;this.l=(A+F/2)*z;this.r=(s+F/2)*z;this.H=Math.max(0,this.h);this.D=Math.max(0,this.d);this.x=this.y=0;this.scale=z}},{glyphs:{},defs:null,n:0});e.Register.StartupHook("mml Jax Ready",function(){j=MathJax.ElementJax.mml;f=MathJax.InputJax.TeX.Definitions;j.hole=j.mbase.Subclass({SVG:m.ROW,type:"hole",cursorable:true,moveCursorFromParent:function(s,r){s.moveTo(this,0);return true},moveCursorFromChild:function(s,r,t){throw new Error("Hole does not have a child")},moveCursorFromClick:function(s,r,t){s.moveTo(this,0);return true},moveCursor:function(s,r){return this.parent.moveCursorFromChild(s,r,this)},drawCursor:function(u){var t=this.getSVGBBox();var s=t.x+(t.width/2);var v=t.y;var r=t.height;u.drawAt(this.EditableSVGelem.ownerSVGElement,s,v,r)},toSVG:function(u,w){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);if(w!=null){s.sh=u;s.sd=w}for(var t=0,r=this.data.length;t<r;t++){if(this.data[t]){s.Check(this.data[t])}}s.Clean();var v=a.createHole(300,400);s.Add(v,0,0);s.Clean();this.SVGhandleColor(s);this.SVGsaveData(s);return s}});function q(r){if(isNaN(r)){switch(r[0].toLowerCase()){case"u":return o;case"d":return l;case"l":return c;case"r":return i}throw new Error("Invalid cursor value")}else{return r}}j.mbase.Augment({SVG:m,getSVGBBox:function(w){var w=w||this.EditableSVGelem;if(!w||!w.ownerSVGElement){return}var z=w.getBBox();if(w.nodeName==="use"){z.x+=Number(w.getAttribute("x"));z.y+=Number(w.getAttribute("y"))}var v=w.getTransformToElement(w.ownerSVGElement);var t=w.ownerSVGElement.createSVGPoint();var u=1/0,s=1/0,y=-1/0,x=-1/0;r(z.x,z.y);r(z.x+z.width,z.y);r(z.x,z.y+z.height);r(z.x+z.width,z.y+z.height);return{x:u,y:s,width:y-u,height:x-s};function r(A,C){t.x=A;t.y=C;var B=t.matrixTransform(v);u=Math.min(u,B.x);s=Math.min(s,B.y);y=Math.max(y,B.x);x=Math.max(x,B.y)}},getBB:function(r){var s=this.EditableSVGelem;return s&&s.getBBox()},moveCursor:function(s,r){this.parent.moveCursorFromChild(s,r,this)},moveCursorFromChild:function(s,r,t){throw new Error("Unimplemented as cursor container")},moveCursorFromParent:function(s,r){return false},moveCursorFromClick:function(s,r,t){return false},drawCursor:function(r){throw new Error("Unable to draw cursor")},drawCursorHighlight:function(t){var s=this.getSVGBBox();var r=this.EditableSVGelem.ownerSVGElement;t.drawHighlightAt(r,s.x,s.y,s.width,s.height)},toSVG:function(){this.SVGgetStyles();var u=this.SVGgetVariant();var s=this.SVG();this.SVGgetScale(s);this.SVGhandleSpace(s);for(var t=0,r=this.data.length;t<r;t++){if(this.data[t]){var w=s.Add(this.data[t].toSVG(u,s.scale),s.w,0,true);if(w.skew){s.skew=w.skew}}}s.Clean();var v=this.data.join("");if(s.skew&&v.length!==1){delete s.skew}if(s.r>s.w&&v.length===1&&!u.noIC){s.ic=s.r-s.w;s.w=s.r}this.SVGhandleColor(s);this.SVGsaveData(s);return s},SVGchildSVG:function(r){return(this.data[r]?this.data[r].toSVG():m())},EditableSVGdataStretched:function(s,r,t){this.EditableSVGdata={HW:r,D:t};if(!this.data[s]){return m()}if(t!=null){return this.data[s].SVGstretchV(r,t)}if(r!=null){return this.data[s].SVGstretchH(r)}return this.data[s].toSVG()},SVGsaveData:function(s){this.EditableSVGelem=s.element;if(!this.EditableSVGdata){this.EditableSVGdata={}}this.EditableSVGdata.w=s.w,this.EditableSVGdata.x=s.x;this.EditableSVGdata.h=s.h,this.EditableSVGdata.d=s.d;if(s.y){this.EditableSVGdata.h+=s.y;this.EditableSVGdata.d-=s.y}if(s.X!=null){this.EditableSVGdata.X=s.X}if(s.tw!=null){this.EditableSVGdata.tw=s.tw}if(s.skew){this.EditableSVGdata.skew=s.skew}if(s.ic){this.EditableSVGdata.ic=s.ic}if(this["class"]){s.removeable=false;a.Element(s.element,{"class":this["class"]})}if(this.id){s.removeable=false;a.Element(s.element,{id:this.id})}if(this.href){var r=a.Element("a",{"class":"mjx-svg-href"});r.setAttributeNS(n,"href",this.href);r.onclick=this.SVGlink;a.addElement(r,"rect",{width:s.w,height:s.h+s.d,y:-s.d,fill:"none",stroke:"none","pointer-events":"all"});if(s.type==="svg"){var u=s.element.firstChild;while(u.firstChild){r.appendChild(u.firstChild)}u.appendChild(r)}else{r.appendChild(s.element);s.element=r}s.removeable=false}if(a.config.addMMLclasses){this.SVGaddClass(s.element,"mjx-svg-"+this.type);s.removeable=false}var t=this.style;if(t&&s.element){s.element.style.cssText=t;if(s.element.style.fontSize){s.element.style.fontSize=""}s.element.style.border=s.element.style.padding="";if(s.removeable){s.removeable=(s.element.style.cssText==="")}}this.SVGaddAttributes(s)},SVGaddClass:function(t,r){var s=t.getAttribute("class");t.setAttribute("class",(s?s+" ":"")+r)},SVGaddAttributes:function(s){if(this.attrNames){var y=this.attrNames,u=j.nocopyAttributes,x=e.config.ignoreMMLattributes;var v=(this.type==="mstyle"?j.math.prototype.defaults:this.defaults);for(var t=0,r=y.length;t<r;t++){var w=y[t];if(x[w]==false||(!u[w]&&!x[w]&&v[w]==null&&typeof(s.element[w])==="undefined")){s.element.setAttribute(w,this.attr[w]);s.removeable=false}}}},SVGlink:function(){var r=this.href.animVal;if(r.charAt(0)==="#"){var s=a.hashCheck(document.getElementById(r.substr(1)));if(s&&s.scrollIntoView){setTimeout(function(){s.parentNode.scrollIntoView(true)},1)}}document.location=r},SVGgetStyles:function(){if(this.style){var r=h.Element("span");r.style.cssText=this.style;this.styles=this.SVGprocessStyles(r.style)}},SVGprocessStyles:function(r){var s={border:a.getBorders(r),padding:a.getPadding(r)};if(!s.border){delete s.border}if(!s.padding){delete s.padding}if(r.fontSize){s.fontSize=r.fontSize}if(r.color){s.color=r.color}if(r.backgroundColor){s.background=r.backgroundColor}if(r.fontStyle){s.fontStyle=r.fontStyle}if(r.fontWeight){s.fontWeight=r.fontWeight}if(r.fontFamily){s.fontFamily=r.fontFamily}if(s.fontWeight&&s.fontWeight.match(/^\d+$/)){s.fontWeight=(parseInt(s.fontWeight)>600?"bold":"normal")}return s},SVGhandleSpace:function(u){if(this.useMMLspacing){if(this.type!=="mo"){return}var t=this.getValues("scriptlevel","lspace","rspace");if(t.scriptlevel<=0||this.hasValue("lspace")||this.hasValue("rspace")){var s=this.SVGgetMu(u);t.lspace=Math.max(0,a.length2em(t.lspace,s));t.rspace=Math.max(0,a.length2em(t.rspace,s));var r=this,v=this.Parent();while(v&&v.isEmbellished()&&v.Core()===r){r=v;v=v.Parent()}if(t.lspace){u.x+=t.lspace}if(t.rspace){u.X=t.rspace}}}else{var w=this.texSpacing();this.SVGgetScale();if(w!==""){u.x+=a.length2em(w,this.scale)*this.mscale}}},SVGhandleColor:function(v){var E=this.getValues("mathcolor","color");if(this.styles&&this.styles.color&&!E.color){E.color=this.styles.color}if(E.color&&!this.mathcolor){E.mathcolor=E.color}if(E.mathcolor){a.Element(v.element,{fill:E.mathcolor,stroke:E.mathcolor});v.removeable=false}var z=(this.styles||{}).border,C=(this.styles||{}).padding,A=((z||{}).left||0),x=((C||{}).left||0),r;E.background=(this.mathbackground||this.background||(this.styles||{}).background||j.COLOR.TRANSPARENT);if(A+x){var s=m();for(r in v){if(v.hasOwnProperty(r)){s[r]=v[r]}}s.x=0;s.y=0;v.element=a.Element("g");v.removeable=true;v.Add(s,A+x,0)}if(C){v.w+=C.right||0;v.h+=C.top||0;v.d+=C.bottom||0}if(z){v.w+=z.right||0;v.h+=z.top||0;v.d+=z.bottom||0}if(E.background!==j.COLOR.TRANSPARENT){var B=v.element.nodeName.toLowerCase();if(B!=="g"&&B!=="svg"){var w=a.Element("g");w.appendChild(v.element);v.element=w;v.removeable=true}v.Add(m.RECT(v.h,v.d,v.w,{fill:E.background,stroke:"none"}),0,0,false,true)}if(z){var D=5;var t={left:["V",v.h+v.d,-D,-v.d],right:["V",v.h+v.d,v.w-z.right+D,-v.d],top:["H",v.w,0,v.h-z.top+D],bottom:["H",v.w,0,-v.d-D]};for(r in t){if(t.hasOwnProperty(r)){if(z[r]){var y=t[r],u=m[y[0]+"LINE"];v.Add(u(y[1],z[r],z[r+"Style"],z[r+"Color"]),y[2],y[3])}}}}},SVGhandleVariant:function(r,t,s){return a.HandleVariant(r,t,s)},SVGgetVariant:function(){var r=this.getValues("mathvariant","fontfamily","fontweight","fontstyle");var s=r.mathvariant;if(this.variantForm){s="-TeX-variant"}r.hasVariant=this.Get("mathvariant",true);if(!r.hasVariant){r.family=r.fontfamily;r.weight=r.fontweight;r.style=r.fontstyle}if(this.styles){if(!r.style&&this.styles.fontStyle){r.style=this.styles.fontStyle}if(!r.weight&&this.styles.fontWeight){r.weight=this.styles.fontWeight}if(!r.family&&this.styles.fontFamily){r.family=this.styles.fontFamily}}if(r.family&&!r.hasVariant){if(!r.weight&&r.mathvariant.match(/bold/)){r.weight="bold"}if(!r.style&&r.mathvariant.match(/italic/)){r.style="italic"}s={forceFamily:true,font:{"font-family":r.family}};if(r.style){s.font["font-style"]=r.style}if(r.weight){s.font["font-weight"]=r.weight}return s}if(r.weight==="bold"){s={normal:j.VARIANT.BOLD,italic:j.VARIANT.BOLDITALIC,fraktur:j.VARIANT.BOLDFRAKTUR,script:j.VARIANT.BOLDSCRIPT,"sans-serif":j.VARIANT.BOLDSANSSERIF,"sans-serif-italic":j.VARIANT.SANSSERIFBOLDITALIC}[s]||s}else{if(r.weight==="normal"){s={bold:j.VARIANT.normal,"bold-italic":j.VARIANT.ITALIC,"bold-fraktur":j.VARIANT.FRAKTUR,"bold-script":j.VARIANT.SCRIPT,"bold-sans-serif":j.VARIANT.SANSSERIF,"sans-serif-bold-italic":j.VARIANT.SANSSERIFITALIC}[s]||s}}if(r.style==="italic"){s={normal:j.VARIANT.ITALIC,bold:j.VARIANT.BOLDITALIC,"sans-serif":j.VARIANT.SANSSERIFITALIC,"bold-sans-serif":j.VARIANT.SANSSERIFBOLDITALIC}[s]||s}else{if(r.style==="normal"){s={italic:j.VARIANT.NORMAL,"bold-italic":j.VARIANT.BOLD,"sans-serif-italic":j.VARIANT.SANSSERIF,"sans-serif-bold-italic":j.VARIANT.BOLDSANSSERIF}[s]||s}}if(!(s in a.FONTDATA.VARIANT)){s="normal"}return a.FONTDATA.VARIANT[s]},SVGgetScale:function(s){var t=1;if(this.mscale){t=this.scale}else{var r=this.getValues("scriptlevel","fontsize");r.mathsize=(this.isToken?this:this.Parent()).Get("mathsize");if((this.styles||{}).fontSize&&!r.fontsize){r.fontsize=this.styles.fontSize}if(r.fontsize&&!this.mathsize){r.mathsize=r.fontsize}if(r.scriptlevel!==0){if(r.scriptlevel>2){r.scriptlevel=2}t=Math.pow(this.Get("scriptsizemultiplier"),r.scriptlevel);r.scriptminsize=a.length2em(this.Get("scriptminsize"))/1000;if(t<r.scriptminsize){t=r.scriptminsize}}this.scale=t;this.mscale=a.length2em(r.mathsize)/1000}if(s){s.scale=t;if(this.isToken){s.scale*=this.mscale}}return t*this.mscale},SVGgetMu:function(t){var r=1,s=this.getValues("scriptlevel","scriptsizemultiplier");if(t.scale&&t.scale!==1){r=1/t.scale}if(s.scriptlevel!==0){if(s.scriptlevel>2){s.scriptlevel=2}r=Math.sqrt(Math.pow(s.scriptsizemultiplier,s.scriptlevel))}return r},SVGnotEmpty:function(r){while(r){if((r.type!=="mrow"&&r.type!=="texatom")||r.data.length>1){return true}r=r.data[0]}return false},SVGcanStretch:function(t){var s=false;if(this.isEmbellished()){var r=this.Core();if(r&&r!==this){s=r.SVGcanStretch(t);if(s&&r.forceStretch){this.forceStretch=true}}}return s},SVGstretchV:function(r,s){return this.toSVG(r,s)},SVGstretchH:function(r){return this.toSVG(r)},SVGlineBreaks:function(){return false}},{SVGautoload:function(){var r=a.autoloadDir+"/"+this.type+".js";e.RestartAfter(k.Require(r))},SVGautoloadFile:function(r){var s=a.autoloadDir+"/"+r+".js";e.RestartAfter(k.Require(s))}});j.chars.Augment({toSVG:function(t,w,s,u){var v=this.data.join("").replace(/[\u2061-\u2064]/g,"");if(s){v=s(v,u)}var r=this.SVGhandleVariant(t,w,v);return r}});j.entity.Augment({toSVG:function(s,v,r,t){var u=this.toString().replace(/[\u2061-\u2064]/g,"");if(r){u=r(u,t)}return this.SVGhandleVariant(s,v,u)}});j.mo.Augment({toSVG:function(s,r){this.SVGgetStyles();var A=this.svg=this.SVG();var v=this.SVGgetScale(A);this.SVGhandleSpace(A);if(this.data.length==0){A.Clean();this.SVGsaveData(A);return A}if(r!=null){return this.SVGstretchV(s,r)}else{if(s!=null){return this.SVGstretchH(s)}}var y=this.SVGgetVariant();var G=this.getValues("largeop","displaystyle");if(G.largeop){y=a.FONTDATA.VARIANT[G.displaystyle?"-largeOp":"-smallOp"]}var F=this.CoreParent(),w=(F&&F.isa(j.msubsup)&&this!==F.data[0]),t=(w?this.remapChars:null);if(this.data.join("").length===1&&F&&F.isa(j.munderover)&&this.CoreText(F.data[F.base]).length===1){var B=F.data[F.over],E=F.data[F.under];if(B&&this===B.CoreMO()&&F.Get("accent")){t=a.FONTDATA.REMAPACCENT}else{if(E&&this===E.CoreMO()&&F.Get("accentunder")){t=a.FONTDATA.REMAPACCENTUNDER}}}if(w&&this.data.join("").match(/['`"\u00B4\u2032-\u2037\u2057]/)){y=a.FONTDATA.VARIANT["-TeX-variant"]}for(var z=0,u=this.data.length;z<u;z++){if(this.data[z]){var H=this.data[z].toSVG(y,v,this.remap,t),C=A.w;if(C===0&&-H.l>10*H.w){C+=-H.l}A.Add(H,C,0,true);if(H.skew){A.skew=H.skew}}}A.Clean();if(this.data.join("").length!==1){delete A.skew}if(G.largeop){A.y=a.TeX.axis_height-(A.h-A.d)/2/v;if(A.r>A.w){A.ic=A.r-A.w;A.w=A.r}}this.SVGhandleColor(A);this.SVGsaveData(A);return A},SVGcanStretch:function(v){if(!this.Get("stretchy")){return false}var w=this.data.join("");if(w.length>1){return false}var s=this.CoreParent();if(s&&s.isa(j.munderover)&&this.CoreText(s.data[s.base]).length===1){var u=s.data[s.over],r=s.data[s.under];if(u&&this===u.CoreMO()&&s.Get("accent")){w=a.FONTDATA.REMAPACCENT[w]||w}else{if(r&&this===r.CoreMO()&&s.Get("accentunder")){w=a.FONTDATA.REMAPACCENTUNDER[w]||w}}}w=a.FONTDATA.DELIMITERS[w.charCodeAt(0)];var t=(w&&w.dir==v.substr(0,1));if(!t){delete this.svg}this.forceStretch=t&&(this.Get("minsize",true)||this.Get("maxsize",true));return t},SVGstretchV:function(w,x){var t=this.svg||this.toSVG();var s=this.getValues("symmetric","maxsize","minsize");var v=a.TeX.axis_height*t.scale,r=this.SVGgetMu(t),u;if(s.symmetric){u=2*Math.max(w-v,x+v)}else{u=w+x}s.maxsize=a.length2em(s.maxsize,r,t.h+t.d);s.minsize=a.length2em(s.minsize,r,t.h+t.d);u=Math.max(s.minsize,Math.min(s.maxsize,u));if(u!=s.minsize){u=[Math.max(u*a.TeX.delimiterfactor/1000,u-a.TeX.delimitershortfall),u]}t=a.createDelimiter(this.data.join("").charCodeAt(0),u,t.scale);if(s.symmetric){u=(t.h+t.d)/2+v}else{u=(t.h+t.d)*w/(w+x)}t.y=u-t.h;this.SVGhandleSpace(t);this.SVGhandleColor(t);delete this.svg.element;this.SVGsaveData(t);t.stretched=true;return t},SVGstretchH:function(s){var u=this.svg||this.toSVG(),r=this.SVGgetMu(u);var t=this.getValues("maxsize","minsize","mathvariant","fontweight");if((t.fontweight==="bold"||parseInt(t.fontweight)>=600)&&!this.Get("mathvariant",true)){t.mathvariant=j.VARIANT.BOLD}t.maxsize=a.length2em(t.maxsize,r,u.w);t.minsize=a.length2em(t.minsize,r,u.w);s=Math.max(t.minsize,Math.min(t.maxsize,s));u=a.createDelimiter(this.data.join("").charCodeAt(0),s,u.scale,t.mathvariant);this.SVGhandleSpace(u);this.SVGhandleColor(u);delete this.svg.element;this.SVGsaveData(u);u.stretched=true;return u}});j.mn.Augment({cursorable:true,getCursorLength:function(){return this.data[0].data[0].length},moveCursor:function(u,t){t=q(t);var r=t===o||t===l;if(r){return this.parent.moveCursorFromChild(u,t,this)}var s=u.position+(t===c?-1:1);if(s<0||s>this.getCursorLength()){this.parent.moveCursorFromChild(u,t,this);return}u.moveTo(this,s)},moveCursorFromChild:function(s,r,t){throw new Error("Unimplemented as cursor container")},moveCursorFromParent:function(s,r){r=q(r);if(r===c){s.moveTo(this,this.getCursorLength())}else{if(r===i){s.moveTo(this,0)}else{if(s.renderedPosition&&this.moveCursorFromClick(s,s.renderedPosition.x,s.renderedPosition.y)){return true}else{s.moveTo(this,0)}}}return true},moveCursorFromClick:function(u,r,v){for(childIdx=0;childIdx<this.getCursorLength();++childIdx){var t=this.getSVGBBox(this.EditableSVGelem.children[childIdx]);var s=t.x+(t.width/2);if(r<s){u.moveTo(this,childIdx);return true}}u.moveTo(this,this.data.length);return true},drawCursor:function(w){var z=this.getSVGBBox();var A=z.height;var u=z.y;var r,s;if(w.position===0){r=z.x}else{var t=this.getSVGBBox(this.EditableSVGelem.children[w.position-1]);r=t.x+t.width}if(w.position===this.getCursorLength()){s=z.x+z.width}else{var B=this.getSVGBBox(this.EditableSVGelem.children[w.position]);s=B.x}var v=(s+r)/2;var C=this.EditableSVGelem.ownerSVGElement;w.drawAt(C,v,u,A)}});j.mtext.Augment({toSVG:function(){if(a.config.mtextFontInherit||this.Parent().type==="merror"){this.SVGgetStyles();var r=this.SVG(),u=this.SVGgetScale(r);this.SVGhandleSpace(r);var s=this.SVGgetVariant(),t={direction:this.Get("dir")};if(s.bold){t["font-weight"]="bold"}if(s.italic){t["font-style"]="italic"}s=this.Get("mathvariant");if(s==="monospace"){t["class"]="MJX-monospace"}else{if(s.match(/sans-serif/)){t["class"]="MJX-sans-serif"}}r.Add(m.TEXT(u*100/a.config.scale,this.data.join(""),t));r.Clean();this.SVGhandleColor(r);this.SVGsaveData(r);return r}else{return this.SUPER(arguments).toSVG.call(this)}}});j.merror.Augment({toSVG:function(t,r){this.SVGgetStyles();var x=this.SVG(),v=a.length2em(this.styles.fontSize||1)/1000;this.SVGhandleSpace(x);var s=(v!==1?{transform:"scale("+a.Fixed(v)+")"}:{});var z=m(s);z.Add(this.SVGchildSVG(0));z.Clean();if(v!==1){z.removeable=false;var y=["w","h","d","l","r","D","H"];for(var w=0,u=y.length;w<u;w++){z[y[w]]*=v}}x.Add(z);x.Clean();this.SVGhandleColor(x);this.SVGsaveData(x);return x},SVGgetStyles:function(){var r=h.Element("span",{style:a.config.merrorStyle});this.styles=this.SVGprocessStyles(r.style);if(this.style){r.style.cssText=this.style;e.Insert(this.styles,this.SVGprocessStyles(r.style))}}});j.ms.Augment({toSVG:j.mbase.SVGautoload});j.mglyph.Augment({toSVG:j.mbase.SVGautoload});j.mspace.Augment({toSVG:function(){this.SVGgetStyles();var t=this.getValues("height","depth","width");t.mathbackground=this.mathbackground;if(this.background&&!this.mathbackground){t.mathbackground=this.background}var s=this.SVG();this.SVGgetScale(s);var u=this.mscale,r=this.SVGgetMu(s);s.h=a.length2em(t.height,r)*u;s.d=a.length2em(t.depth,r)*u;s.w=s.r=a.length2em(t.width,r)*u;if(s.w<0){s.x=s.w;s.w=s.r=0}if(s.h<-s.d){s.d=-s.h}s.l=0;s.Clean();this.SVGhandleColor(s);this.SVGsaveData(s);return s}});j.mphantom.Augment({toSVG:function(r,t){this.SVGgetStyles();var s=this.SVG();this.SVGgetScale(s);if(this.data[0]!=null){this.SVGhandleSpace(s);s.Add(this.EditableSVGdataStretched(0,r,t));s.Clean();while(s.element.firstChild){s.element.removeChild(s.element.firstChild)}}this.SVGhandleColor(s);this.SVGsaveData(s);if(s.removeable&&!s.element.firstChild){delete s.element}return s}});j.mpadded.Augment({toSVG:function(u,r){this.SVGgetStyles();var z=this.SVG();if(this.data[0]!=null){this.SVGgetScale(z);this.SVGhandleSpace(z);var v=this.EditableSVGdataStretched(0,u,r),F=this.SVGgetMu(z);var E=this.getValues("height","depth","width","lspace","voffset"),t=0,s=0;if(E.lspace){t=this.SVGlength2em(v,E.lspace,F)}if(E.voffset){s=this.SVGlength2em(v,E.voffset,F)}var x=v.h,A=v.d,C=v.w,B=v.y;z.Add(v,t,s);z.Clean();z.h=x+B;z.d=A-B;z.w=C;z.removeable=false;if(E.height!==""){z.h=this.SVGlength2em(z,E.height,F,"h",0)}if(E.depth!==""){z.d=this.SVGlength2em(z,E.depth,F,"d",0)}if(E.width!==""){z.w=this.SVGlength2em(z,E.width,F,"w",0)}if(z.h>z.H){z.H=z.h}if(z.d>z.D){z.D=z.d}}this.SVGhandleColor(z);this.SVGsaveData(z);return z},SVGlength2em:function(u,y,s,z,r){if(r==null){r=-a.BIGDIMEN}var w=String(y).match(/width|height|depth/);var x=(w?u[w[0].charAt(0)]:(z?u[z]:0));var t=a.length2em(y,s,x/this.mscale)*this.mscale;if(z&&String(y).match(/^\s*[-+]/)){return Math.max(r,u[z]+t)}else{return t}}});j.mrow.Augment({SVG:m.ROW,cursorable:true,isCursorPassthrough:function(){return false},moveCursorFromParent:function(s,r){r=q(r);if(this.isCursorPassthrough()){return this.data[0].moveCursorFromParent(s,r)}if(r===c){s.moveTo(this,this.data.length)}else{if(r===i){s.moveTo(this,0)}else{if(s.renderedPosition&&this.moveCursorFromClick(s,s.renderedPosition.x,s.renderedPosition.y)){return true}else{s.moveTo(this,0)}}}return true},moveCursorFromChild:function(t,s,u){if(this.isCursorPassthrough()||s===o||s===l){return this.parent.moveCursorFromChild(t,s,this)}s=q(s);var r;for(r=0;r<this.data.length;++r){if(u===this.data[r]){break}}if(r===this.data.length){throw new Error("Unable to find specified child in children")}if(s===c){t.moveTo(this,r)}else{if(s===i){t.moveTo(this,r+1)}}return true},moveCursorFromClick:function(u,r,w){for(childIdx=0;childIdx<this.data.length;++childIdx){var v=this.data[childIdx];var t=v.getSVGBBox();if(!t){continue}var s=t.x+(t.width/2);if(r<s){u.moveTo(this,childIdx);return true}}u.moveTo(this,this.data.length);return true},moveCursor:function(v,u){u=q(u);var s=u===o||u===l;if(s){return this.parent.moveCursorFromChild(v,u,this)}var t=v.position+(u===c?-1:1);if(t<0||t>this.data.length){this.parent.moveCursorFromChild(v,u,this);return}var r=u===c?v.position-1:v.position;if(v.mode===v.SELECTION){v.moveTo(this,t);return}if(this.data[r].moveCursorFromParent(v,u)){return}v.moveTo(this,t)},drawCursor:function(w){var z=this.getSVGBBox();var A=z.height;var u=z.y;var r,s;if(w.position===0){r=z.x}else{var t=this.data[w.position-1].getSVGBBox();r=t.x+t.width}if(w.position===this.data.length){s=z.x+z.width}else{var B=this.data[w.position].getSVGBBox();s=B.x}var v=(s+r)/2;var C=this.EditableSVGelem.ownerSVGElement;w.drawAt(C,v,u,A)},toSVG:function(u,w){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);if(w!=null){s.sh=u;s.sd=w}for(var t=0,r=this.data.length;t<r;t++){if(this.data[t]){s.Check(this.data[t])}}s.Stretch();s.Clean();if(this.data.length===1&&this.data[0]){var v=this.data[0].EditableSVGdata;if(v.skew){s.skew=v.skew}}if(this.SVGlineBreaks(s)){s=this.SVGmultiline(s)}this.SVGhandleColor(s);this.SVGsaveData(s);return s},drawCursorHighlight:function(z){var v=this.getSVGBBox();var B=this.EditableSVGelem.ownerSVGElement;if(z.selectionStart.node!==this){var y=z.selectionStart.node;var A=false;while(y){if(y.parent===this){z.selectionStart={node:this,position:this.data.indexOf(y)+1};A=true;break}y=y.parent}if(!A){throw new Error("Don't know how to deal with selectionStart not in mrow")}}if(z.selectionEnd.node!==this){throw new Error("Don't know how to deal with selectionStart not in mrow")}var x=Math.min(z.selectionStart.position,z.selectionEnd.position);var w=Math.max(z.selectionStart.position,z.selectionEnd.position);if(x===w){z.clearHighlight();return}var t=this.data[x].getSVGBBox().x;var u=this.data[w-1].getSVGBBox();var r=u.x+u.width;var s=r-t;var v=this.getSVGBBox();var B=this.EditableSVGelem.ownerSVGElement;z.drawHighlightAt(B,t,v.y,s,v.height)},SVGlineBreaks:function(r){if(!this.parent.linebreakContainer){return false}return(a.config.linebreaks.automatic&&r.w>a.linebreakWidth)||this.hasNewline()},SVGmultiline:function(r){j.mbase.SVGautoloadFile("multiline")},SVGstretchH:function(s){var t=this.SVG();this.SVGhandleSpace(t);for(var u=0,r=this.data.length;u<r;u++){t.Add(this.EditableSVGdataStretched(u,s),t.w,0)}t.Clean();this.SVGhandleColor(t);this.SVGsaveData(t);return t}});j.mstyle.Augment({toSVG:function(){this.SVGgetStyles();var r=this.SVG();if(this.data[0]!=null){this.SVGhandleSpace(r);var s=r.Add(this.data[0].toSVG());r.Clean();if(s.ic){r.ic=s.ic}this.SVGhandleColor(r)}this.SVGsaveData(r);return r},SVGstretchH:function(r){return(this.data[0]!=null?this.data[0].SVGstretchH(r):m.NULL())},SVGstretchV:function(r,s){return(this.data[0]!=null?this.data[0].SVGstretchV(r,s):m.NULL())}});j.mfrac.Augment({name:"mfrac",toSVG:function(){this.SVGgetStyles();var D=this.SVG();var M=this.SVGgetScale(D);var w=m();w.scale=D.scale;this.SVGhandleSpace(w);var y=this.SVGchildSVG(0),x=this.SVGchildSVG(1);var r=this.getValues("displaystyle","linethickness","numalign","denomalign","bevelled");var I=r.displaystyle;var L=a.TeX.axis_height*M;if(r.bevelled){var K=(I?400:150);var z=Math.max(y.h+y.d,x.h+x.d)+2*K;var J=a.createDelimiter(47,z);w.Add(y,0,(y.d-y.h)/2+L+K);w.Add(J,y.w-K/2,(J.d-J.h)/2+L);w.Add(x,y.w+J.w-K,(x.d-x.h)/2+L-K)}else{var s=Math.max(y.w,x.w);var C=a.thickness2em(r.linethickness,this.scale)*this.mscale,F,E,B,A;var G=a.TeX.min_rule_thickness/a.em*1000;if(I){B=a.TeX.num1;A=a.TeX.denom1}else{B=(C===0?a.TeX.num3:a.TeX.num2);A=a.TeX.denom2}B*=M;A*=M;if(C===0){F=Math.max((I?7:3)*a.TeX.rule_thickness,2*G);E=(B-y.d)-(x.h-A);if(E<F){B+=(F-E)/2;A+=(F-E)/2}w.w=s;C=0}else{F=Math.max((I?2:0)*G+C,C/2+1.5*G);E=(B-y.d)-(L+C/2);if(E<F){B+=F-E}E=(L-C/2)-(x.h-A);if(E<F){A+=F-E}w.Add(m.RECT(C/2,C/2,s+2*C),0,L)}w.Align(y,r.numalign,C,B);w.Align(x,r.denomalign,C,-A)}w.Clean();D.Add(w,0,0);D.Clean();this.SVGhandleColor(D);this.SVGsaveData(D);return D},cursorable:true,moveCursorFromClick:function(u,r,w){var t=this.getSVGBBox();var s=t.y+(t.height/2);var v=t.x+(t.width/2);u.position={position:(r<v)?0:1,half:(w<s)?0:1};if(this.data[u.position.half].cursorable){this.data[u.position.half].moveCursorFromClick(u,r,w);return}u.moveTo(this,u.position)},moveCursor:function(s,r){if(s.position.half===undefined){throw new Error("Invalid cursor")}if(s.position.position===0&&r===i){s.position.position=1}else{if(s.position.position===1&&r===c){s.position.position=0}else{if(s.position.half===0&&r===l){return this.moveCursorIntoDenominator(s,r)}else{if(s.position.half===1&&r===o){return this.moveCursorIntoNumerator(s,r)}else{return this.parent.moveCursorFromChild(s,r,this)}}}}s.moveTo(this,s.position)},moveCursorFromChild:function(v,u,w,r){var t=this.data[0]===w;var s=this.data[1]===w;if(!t&&!s){throw new Error("Specified child not found in children")}if(t&&u===l){return this.moveCursorIntoDenominator(v,u)}else{if(s&&u===o){return this.moveCursorIntoNumerator(v,u)}else{if(r){return this.moveCursorIntoHalf(t?0:1,v,u)}else{return this.parent.moveCursorFromChild(v,u,this)}}}},moveCursorIntoHalf:function(s,v,t){if(this.data[s].cursorable){return this.data[s].moveCursorFromParent(v,t)}var r=0;if(v.renderedPosition){var u=this.data[s].getSVGBBox();if(u&&v.renderedPosition.x>u.x+u.width/2){r=1}}v.moveTo(this,{half:s,position:r});return true},moveCursorIntoNumerator:function(s,r){return this.moveCursorIntoHalf(0,s,r)},moveCursorIntoDenominator:function(s,r){return this.moveCursorIntoHalf(1,s,r)},moveCursorFromParent:function(s,r){r=q(r);switch(r){case c:case i:if(this.data[0].cursorable){return this.data[0].moveCursorFromParent(s,r)}s.moveTo(this,{half:0,position:r===i?0:1});return true;case o:return this.moveCursorIntoDenominator(s,r);case l:return this.moveCursorIntoNumerator(s,r)}return false},drawCursor:function(v){if(v.position.half===undefined){throw new Error("Invalid cursor")}var u=this.data[v.position.half].getSVGBBox();var s=u.height;var r=u.x+(v.position.position?u.width+100:-100);var w=u.y;var t=this.EditableSVGelem.ownerSVGElement;return v.drawAt(t,r,w,s)},SVGcanStretch:function(r){return false},SVGhandleSpace:function(r){if(!this.texWithDelims&&!this.useMMLspacing){r.x=r.X=a.TeX.nulldelimiterspace*this.mscale}this.SUPER(arguments).SVGhandleSpace.call(this,r)}});j.msqrt.Augment({toSVG:function(){this.SVGgetStyles();var y=this.SVG(),v=this.SVGgetScale(y);this.SVGhandleSpace(y);var u=this.SVGchildSVG(0),z,w;var C=a.TeX.rule_thickness*v,s,r,B,A=0;if(this.Get("displaystyle")){s=a.TeX.x_height*v}else{s=C}r=Math.max(C+s/4,1000*a.TeX.min_root_space/a.em);B=u.h+u.d+r+C;w=a.createDelimiter(8730,B,v);if(w.h+w.d>B){r=((w.h+w.d)-(B-C))/2}z=m.RECT(C,0,u.w);B=u.h+r+C;A=this.SVGaddRoot(y,w,A,w.h+w.d-B,v);y.Add(w,A,B-w.h);y.Add(z,A+w.w,B-z.h);y.Add(u,A+w.w,0);y.Clean();y.h+=C;y.H+=C;this.SVGhandleColor(y);this.SVGsaveData(y);return y},cursorable:true,moveCursorFromChild:function(s,r){this.parent.moveCursorFromChild(s,r,this)},moveCursorFromParent:function(s,r){return this.data[0].moveCursorFromParent(s,r)},SVGaddRoot:function(s,t,r,v,u){return r}});j.mroot.Augment({toSVG:j.msqrt.prototype.toSVG,SVGaddRoot:function(u,s,z,v,r){var B=(s.isMultiChar?0.55:0.65)*s.w;if(this.data[1]){var y=this.data[1].toSVG();y.x=0;var t=this.SVGrootHeight(s.h+s.d,r,y)-v;var A=Math.min(y.w,y.r);z=Math.max(A,B);u.Add(y,z-A,t)}else{B=z}return z-B},cursorable:true,moveCursorFromChild:function(s,r){this.parent.moveCursorFromChild(s,r,this)},moveCursorFromParent:function(s,r){return this.data[0].moveCursorFromParent(s,r)},SVGrootHeight:function(t,s,r){return 0.45*(t-900*s)+600*s+Math.max(0,r.d-75)}});j.mfenced.Augment({SVG:m.ROW,toSVG:function(){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);if(this.data.open){s.Check(this.data.open)}if(this.data[0]!=null){s.Check(this.data[0])}for(var t=1,r=this.data.length;t<r;t++){if(this.data[t]){if(this.data["sep"+t]){s.Check(this.data["sep"+t])}s.Check(this.data[t])}}if(this.data.close){s.Check(this.data.close)}s.Stretch();s.Clean();this.SVGhandleColor(s);this.SVGsaveData(s);return s}});j.menclose.Augment({toSVG:j.mbase.SVGautoload});j.maction.Augment({toSVG:j.mbase.SVGautoload});j.semantics.Augment({toSVG:function(){this.SVGgetStyles();var r=this.SVG();if(this.data[0]!=null){this.SVGhandleSpace(r);r.Add(this.data[0].toSVG());r.Clean()}else{r.Clean()}this.SVGsaveData(r);return r},SVGstretchH:function(r){return(this.data[0]!=null?this.data[0].SVGstretchH(r):m.NULL())},SVGstretchV:function(r,s){return(this.data[0]!=null?this.data[0].SVGstretchV(r,s):m.NULL())}});j.munderover.Augment({toSVG:function(K,I){this.SVGgetStyles();var r=this.getValues("displaystyle","accent","accentunder","align");if(!r.displaystyle&&this.data[this.base]!=null&&this.data[this.base].CoreMO().Get("movablelimits")){return j.msubsup.prototype.toSVG.call(this)}var J=this.SVG(),R=this.SVGgetScale(J);this.SVGhandleSpace(J);var v=[],P=[],B,O,L,s=-a.BIGDIMEN,N=s;for(O=0,L=this.data.length;O<L;O++){if(this.data[O]!=null){if(O==this.base){v[O]=this.EditableSVGdataStretched(O,K,I);P[O]=(I!=null||K==null)&&this.data[O].SVGcanStretch("Horizontal")}else{v[O]=this.data[O].toSVG();v[O].x=0;delete v[O].X;P[O]=this.data[O].SVGcanStretch("Horizontal")}if(v[O].w>N){N=v[O].w}if(!P[O]&&N>s){s=N}}}if(I==null&&K!=null){s=K}else{if(s==-a.BIGDIMEN){s=N}}for(O=N=0,L=this.data.length;O<L;O++){if(this.data[O]){if(P[O]){v[O]=this.data[O].SVGstretchH(s);if(O!==this.base){v[O].x=0;delete v[O].X}}if(v[O].w>N){N=v[O].w}}}var H=a.TeX.rule_thickness*this.mscale;var u=v[this.base]||{w:0,h:0,d:0,H:0,D:0,l:0,r:0,y:0,scale:R};var A,w,E,C,z,G,M,Q=0;if(u.ic){Q=1.3*u.ic+0.05}for(O=0,L=this.data.length;O<L;O++){if(this.data[O]!=null){B=v[O];z=a.TeX.big_op_spacing5*R;var F=(O!=this.base&&r[this.ACCENTS[O]]);if(F&&B.w<=1){B.x=-B.l;v[O]=m.G().With({removeable:false});v[O].Add(B);v[O].Clean();v[O].w=-B.l;B=v[O]}G={left:0,center:(N-B.w)/2,right:N-B.w}[r.align];A=G;w=0;if(O==this.over){if(F){M=H*R;z=0;if(u.skew){A+=u.skew;J.skew=u.skew;if(A+B.w>N){J.skew+=(N-B.w-A)/2}}}else{E=a.TeX.big_op_spacing1*R;C=a.TeX.big_op_spacing3*R;M=Math.max(E,C-Math.max(0,B.d))}M=Math.max(M,1500/a.em);A+=Q/2;w=u.y+u.h+B.d+M;B.h+=z;if(B.h>B.H){B.H=B.h}}else{if(O==this.under){if(F){M=3*H*R;z=0}else{E=a.TeX.big_op_spacing2*R;C=a.TeX.big_op_spacing4*R;M=Math.max(E,C-B.h)}M=Math.max(M,1500/a.em);A-=Q/2;w=u.y-(u.d+B.h+M);B.d+=z;if(B.d>B.D){B.D=B.d}}}J.Add(B,A,w)}}J.Clean();this.SVGhandleColor(J);this.SVGsaveData(J);return J}});j.msubsup.Augment({toSVG:function(N,H){this.SVGgetStyles();var J=this.SVG(),R=this.SVGgetScale(J);this.SVGhandleSpace(J);var L=this.SVGgetMu(J);var z=J.Add(this.EditableSVGdataStretched(this.base,N,H));var y=(this.data[this.sup]||this.data[this.sub]||this).SVGgetScale();var P=a.TeX.x_height*R,G=a.TeX.scriptspace*R;var w,A;if(this.SVGnotEmpty(this.data[this.sup])){w=this.data[this.sup].toSVG();w.w+=G;w.r=Math.max(w.w,w.r)}if(this.SVGnotEmpty(this.data[this.sub])){A=this.data[this.sub].toSVG();A.w+=G;A.r=Math.max(A.w,A.r)}var K=a.TeX.sup_drop*y,I=a.TeX.sub_drop*y;var E=z.h+(z.y||0)-K,C=z.d-(z.y||0)+I,Q=0,M;if(z.ic){z.w-=z.ic;Q=1.3*z.ic+0.05}if(this.data[this.base]&&(this.data[this.base].type==="mi"||this.data[this.base].type==="mo")){if(this.data[this.base].data.join("").length===1&&z.scale===1&&!z.stretched&&!this.data[this.base].Get("largeop")){E=C=0}}var O=this.getValues("subscriptshift","superscriptshift");O.subscriptshift=(O.subscriptshift===""?0:a.length2em(O.subscriptshift,L));O.superscriptshift=(O.superscriptshift===""?0:a.length2em(O.superscriptshift,L));var B=z.w+z.x;if(!w){if(A){C=Math.max(C,a.TeX.sub1*R,A.h-(4/5)*P,O.subscriptshift);J.Add(A,B,-C);this.data[this.sub].EditableSVGdata.dy=-C}}else{if(!A){values=this.getValues("displaystyle","texprimestyle");M=a.TeX[(values.displaystyle?"sup1":(values.texprimestyle?"sup3":"sup2"))];E=Math.max(E,M*R,w.d+(1/4)*P,O.superscriptshift);J.Add(w,B+Q,E);this.data[this.sup].EditableSVGdata.dx=Q;this.data[this.sup].EditableSVGdata.dy=E}else{C=Math.max(C,a.TeX.sub2*R);var F=a.TeX.rule_thickness*R;if((E-w.d)-(A.h-C)<3*F){C=3*F-E+w.d+A.h;K=(4/5)*P-(E-w.d);if(K>0){E+=K;C-=K}}J.Add(w,B+Q,Math.max(E,O.superscriptshift));J.Add(A,B,-Math.max(C,O.subscriptshift));this.data[this.sup].EditableSVGdata.dx=Q;this.data[this.sup].EditableSVGdata.dy=Math.max(E,O.superscriptshift);this.data[this.sub].EditableSVGdata.dy=-Math.max(C,O.subscriptshift)}}J.Clean();this.SVGhandleColor(J);this.SVGsaveData(J);return J}});var p={cursorable:true,moveCursorFromParent:function(w,u){u=q(u);var s;if(u===i||u===c){s=this.data[this.base];if(s.cursorable){return s.moveCursorFromParent(w,u)}w.position={section:this.base,pos:u===c?1:0}}else{if(u===o||u===l){var t=u===o?this.sub:this.sup;var r=this.data[this.base].getSVGBBox();if(!r||!w.renderedPosition){w.position={section:this.data[t]?t:this.base,pos:0}}else{if(w.renderedPosition.x>r.x+r.width&&this.data[t]){if(this.data[t].cursorable){return this.data[t].moveCursorFromParent(w,u)}var v=this.data[t].getSVGBBox();w.position={section:t,pos:w.renderedPosition.x>v.x+v.width/2?1:0}}else{if(this.data[this.base].cursorable){return this.data[this.base].moveCursorFromParent(w,u)}w.position={section:this.base,pos:w.renderedPosition.x>r.x+r.width/2?1:0}}}}}w.moveTo(this,w.position);return true},moveCursorFromChild:function(w,u,y){u=q(u);var t,x;var s;for(s=0;s<this.data.length;++s){if(y===this.data[s]){break}}if(s===this.data.length){throw new Error("Unable to find specified child in children")}var v=s;var r=[w.node,w.position];w.moveTo(this,{section:v,pos:u===i?1:0});if(!this.moveCursor(w,u)){w.moveTo.apply(w,r);return false}return true},moveCursorFromClick:function(B,w,v){var s=this.data[0];var z=s.getSVGBBox();var r=this.data[this.sub];var D=r&&r.getSVGBBox();var t=this.data[this.sup];var E=t&&t.getSVGBBox();var A;var u;if(D&&a.boxContains(D,w,v)){if(r.cursorable){return r.moveCursorFromClick(B,w,v)}A=this.sub;var C=D.x+(D.width/2);u=(w<C)?0:1}else{if(E&&a.boxContains(E,w,v)){if(t.cursorable){return t.moveCursorFromClick(B,w,v)}A=this.sup;var C=E.x+(E.width/2);u=(w<C)?0:1}else{if(s.cursorable){return s.moveCursorFromClick(B,w,v)}A=this.base;var C=z.x+(z.width/2);u=(w<C)?0:1}}B.moveTo(this,{section:A,pos:u})},moveCursor:function(z,w){w=q(w);var v=this.data[this.sup];var r=this.data[this.sub];if(z.position.section===this.base){if(w===o){if(v){if(v.cursorable){return v.moveCursorFromParent(z,w)}z.position={section:this.sup,pos:0}}else{return this.parent.moveCursorFromChild(z,w,this)}}else{if(w===l){if(r){if(r.cursorable){return r.moveCursorFromParent(z,w)}z.position={section:this.sub,pos:0}}else{return this.parent.moveCursorFromChild(z,w,this)}}else{if(w===c&&z.position.pos===0||w===i&&z.position.pos===1){return this.parent.moveCursorFromChild(z,w,this)}z.position.pos=z.position.pos?0:1}}}else{var t=w===o||w===l;var x=t&&(w===o)===(z.position.section===this.sub);var A=z.position.pos===0&&w===c;var y=z.position.pos===1&&w===i;var u=t?!x:!this.rightMoveStay&&y;var s=x||A||y&&this.rightMoveStay;if(u){return this.parent.moveCursorFromChild(z,w,this)}else{if(s){if(this.data[this.base].cursorable){return this.data[this.base].moveCursorFromParent(z,z.position.section===this.sub?o:l)}z.position={section:this.base,pos:y?1:this.endingPos||0}}else{z.position.pos=z.position.pos?0:1}}}z.moveTo(this,z.position);return true},drawCursor:function(w){var v;var s,z,r;if(w.position.section===this.base){v=this.data[this.base].getSVGBBox();var t=this.getSVGBBox();z=t.y;r=t.height}else{v=this.data[w.position.section].getSVGBBox();z=v.y;r=v.height}s=w.position.pos===0?v.x:v.x+v.width;var u=this.EditableSVGelem.ownerSVGElement;return w.drawAt(u,s,z,r)}};j.munderover.Augment(p);j.msubsup.Augment(p);j.msubsup.Augment({endingPos:1});j.munderover.Augment({endingPos:0,rightMoveStay:true});j.mmultiscripts.Augment({toSVG:j.mbase.SVGautoload});j.mtable.Augment({toSVG:j.mbase.SVGautoload});j["annotation-xml"].Augment({toSVG:j.mbase.SVGautoload});j.math.Augment({SVG:m.Subclass({type:"svg",removeable:false}),cursorable:false,loadTexify:function(){j.mbase.SVGautoloadFile("texify")},moveCursorFromChild:function(s,r,t){return false},toSVG:function(D,u,w){var F=a.config;this.loadTexify();if(this.data[0]){this.SVGgetStyles();j.mbase.prototype.displayAlign=e.config.displayAlign;j.mbase.prototype.displayIndent=e.config.displayIndent;if(String(e.config.displayIndent).match(/^0($|[a-z%])/i)){j.mbase.prototype.displayIndent="0"}var z=m.G();z.Add(this.data[0].toSVG(),0,0,true);z.Clean();this.SVGhandleColor(z);a.Element(z.element,{stroke:"currentColor",fill:"currentColor","stroke-width":0,transform:"matrix(1 0 0 -1 0 0)"});z.removeable=false;var A=this.SVG();A.element.setAttribute("xmlns:xlink",n);if(F.useFontCache&&!F.useGlobalCache){A.element.appendChild(m.GLYPH.defs)}A.Add(z);A.Clean();this.SVGsaveData(A);if(!D){A.element=A.element.firstChild;A.element.removeAttribute("transform");A.removable=true;return A}var y=Math.max(-A.l,0),s=Math.max(A.r-A.w,0);var t=A.element.style;A.element.setAttribute("width",a.Ex(y+A.w+s));A.element.setAttribute("height",a.Ex(A.H+A.D+2*a.em));t.verticalAlign=a.Ex(-A.D-2*a.em);t.marginLeft=a.Ex(-y);t.marginRight=a.Ex(-s);A.element.setAttribute("viewBox",a.Fixed(-y,1)+" "+a.Fixed(-A.H-a.em,1)+" "+a.Fixed(y+A.w+s,1)+" "+a.Fixed(A.H+A.D+2*a.em,1));t.marginTop=t.marginBottom="1px";if(A.H>A.h){t.marginTop=a.Ex(A.h-A.H)}if(A.D>A.d){t.marginBottom=a.Ex(A.d-A.D);t.verticalAlign=a.Ex(-A.d)}var C=this.Get("alttext");if(C&&!A.element.getAttribute("aria-label")){D.setAttribute("aria-label",C)}if(!A.element.getAttribute("role")){D.setAttribute("role","math")}A.element.classList.add("rendered-svg-output");var B=D.querySelector(".rendered-svg-output");if(w&&B){D.replaceChild(A.element,B)}else{D.appendChild(A.element)}A.element=null;if(!this.isMultiline&&this.Get("display")==="block"&&!A.hasIndent){var E=this.getValues("indentalignfirst","indentshiftfirst","indentalign","indentshift");if(E.indentalignfirst!==j.INDENTALIGN.INDENTALIGN){E.indentalign=E.indentalignfirst}if(E.indentalign===j.INDENTALIGN.AUTO){E.indentalign=this.displayAlign}if(E.indentshiftfirst!==j.INDENTSHIFT.INDENTSHIFT){E.indentshift=E.indentshiftfirst}if(E.indentshift==="auto"){E.indentshift="0"}var v=a.length2em(E.indentshift,1,a.cwidth);if(this.displayIndent!=="0"){var x=a.length2em(this.displayIndent,1,a.cwidth);v+=(E.indentalign===j.INDENTALIGN.RIGHT?-x:x)}u.style.textAlign=E.indentalign;if(v){e.Insert(t,({left:{marginLeft:a.Ex(v)},right:{marginRight:a.Ex(-v)},center:{marginLeft:a.Ex(v),marginRight:a.Ex(-v)}})[E.indentalign])}}}return D}});j.TeXAtom.Augment({toSVG:function(r,u){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);if(this.data[0]!=null){var t=this.EditableSVGdataStretched(0,r,u),v=0;if(this.texClass===j.TEXCLASS.VCENTER){v=a.TeX.axis_height-(t.h+t.d)/2+t.d}s.Add(t,0,v);s.ic=t.ic;s.skew=t.skew}this.SVGhandleColor(s);this.SVGsaveData(s);return s},cursorable:true,moveCursorFromParent:function(s,r){return this.data[0].moveCursorFromParent(s,r)},moveCursorFromChild:function(s,r,t){return this.parent.moveCursorFromChild(s,r,this)},moveCursorFromClick:function(s,r,t){return this.data[0].moveCursorFromClick(s,r,t)},moveCursor:function(s,r){return this.parent.moveCursorFromChild(s,r,this)},drawCursor:function(r){console.error("TeXAtom drawCursor NOT IMPLEMENTED")}});e.Register.StartupHook("onLoad",function(){setTimeout(MathJax.Callback(["loadComplete",a,"jax.js"]),0)})});MathJax.Object.Cursor=MathJax.Object.Subclass({BACKSLASH:"backslash",NORMAL:"normal",SELECTION:"selection",mode:"normal",selectionStart:null,selectionEnd:null,Init:function(){this.id=Math.random().toString(36).substring(2);this.width=50},refocus:function(){if(!this.node||!this.node.EditableSVGelem||!this.node.EditableSVGelem.ownerSVGElement||!this.node.EditableSVGelem.ownerSVGElement.parentNode){return false}this.node.EditableSVGelem.ownerSVGElement.parentNode.focus();this.draw()},moveToClick:function(s){var w=s.target;var r=w.nodeName==="svg"?w:w.ownerSVGElement;if(!r){return}var v=a.screenCoordsToElemCoords(r,s.clientX,s.clientY);var q=a.getJaxFromMath(r.parentNode);var u=q.root;while(true){var t=u.data.filter(function(x){if(x===null){return false}return a.nodeContainsScreenPoint(x,s.clientX,s.clientY)});if(t.length>1){console.error("huh? matched more than one child")}else{if(t.length===0){break}}var p=t[0];if(p.cursorable){u=p}else{break}}u.moveCursorFromClick(this,v.x,v.y)},moveTo:function(q,p){if(this.mode===this.BACKSLASH&&!q.backslashRow){return false}this.node=q;this.position=p;if(this.mode===this.SELECTION){this.selectionEnd={node:this.node,position:this.position}}},updateSelection:function(p){if(p&&this.mode===this.NORMAL){this.mode=this.SELECTION;this.selectionStart={node:this.node,position:this.position}}else{if(this.mode===this.SELECTION){if(p){this.selectionEnd={node:this.node,position:this.position}}else{this.mode=this.NORMAL;this.selectionStart=this.selectionEnd=null;this.clearHighlight()}}}},move:function(q,p){this.updateSelection(p);this.node.moveCursor(this,q)},draw:function(){this.node.drawCursor(this)},keydown:function(q,p){var r;switch(q.which){case 8:this.backspace(q,p);break;case 27:this.exitBackslashMode();p(["refocus",this]);break;case 38:r=o;break;case 40:r=l;break;case 37:r=c;break;case 39:r=i;break}if(r){this.move(r,q.shiftKey);this.draw();q.preventDefault()}},mousedown:function(q,p){q.preventDefault();this.updateSelection(q.shiftKey);this.moveToClick(q);this.refocus()},makeHoleIfNeeded:function(q){if(q.data.length===0){var r=j.hole();var p=q.parent.data.indexOf(q);q.parent.SetData(p,r);r.moveCursorFromParent(this)}},exitBackslashMode:function(q){this.mode=this.NORMAL;var p=this.node.parent.data.indexOf(this.node);if(!q){this.node.parent.data.splice(p,1)}else{this.node.parent.SetData(p++,q)}if(q&&q.moveCursorAfter){this.moveTo.apply(this,q.moveCursorAfter)}else{this.moveTo(this.node.parent,p)}},backspace:function(t,q){t.preventDefault();if(!this.node){return}if(this.mode===this.SELECTION){if(this.selectionStart.node.type==="mrow"&&this.selectionStart.node===this.selectionEnd.node){var r=Math.min(this.selectionStart.position,this.selectionEnd.position);var p=Math.max(this.selectionStart.position,this.selectionEnd.position);this.selectionStart.node.data.splice(r,p-r);this.moveTo(this.node,r);this.clearHighlight();this.makeHoleIfNeeded(this.node);q(["refocus",this])}else{throw new Error("Don't know how to do this backspace")}return}if(this.node.type==="mrow"){var s=this.node.data[this.position-1];if(!s.cursorable){if(this.mode===this.BACKSLASH&&this.node.data.length===1){this.exitBackslashMode()}else{this.node.data.splice(this.position-1,1);this.position=this.position-1;this.makeHoleIfNeeded(this.node)}q(["refocus",this])}else{this.mode=this.SELECTION;this.selectionStart={node:this.node,position:this.position};this.selectionEnd={node:this.node,position:this.position-1};q(["refocus",this])}}else{if(this.node.type==="hole"){console.log("backspace on hole!")}}},makeEntityMo:function(p){var r=new j.mo();var q=new j.entity();q.Append(p);r.Append(q);return r},makeEntityMi:function(p){var r=new j.mi();var q=new j.entity();q.Append(p);r.Append(q);return r},makeParser:function(){var p={mmlToken:function(q){return q},Push:function(q){this.result=q},noop:function(){},parseControlSequence:function(q){if(this.checkSpecialCS(q)){return this.result}this.cs=q;this.csUndefined=this.csFindMacro=this.noop;this.ControlSequence();delete this.csFindMacro;delete this.csUndefined;return this.result},GetCS:function(){return this.cs},checkSpecialCS:function(r){if(r==="frac"){var t=new j.hole();var q=new j.mfrac(t,new j.hole());q.moveCursorAfter=[t,0];return this.result=q}if(r==="sqrt"){var q=new j.msqrt();var t=new j.hole();q.SetData(0,t);q.moveCursorAfter=[t,0];return this.result=q}if(f.macros[r]){console.log(f.macros[r]);var v=f.macros[r]==="NamedOp"||f.macros[r]==="NamedFn";var u=f.macros[r][0]&&(f.macros[r][0]==="NamedFn"||f.macros[r][0]==="NamedOp");if(v||u){var s;if(u&&f.macros[r][1]){s=f.macros[r][1].replace(/&thinsp;/,"\u2006")}else{s=r}return this.result=new j.mo(new j.chars(s))}}},stack:{env:{}}};p.__proto__=MathJax.InputJax.TeX.Parse.prototype;return p},keypress:function(H,s){H.preventDefault();var p=H.charCode||H.keyCode||H.which;var K=String.fromCharCode(p);var G;if(!this.node){return}if(this.node.type==="hole"){var z=this.node.parent;var x=z.data.indexOf(this.node);var t=j.mrow();z.SetData(x,t);t.moveCursorFromParent(this,i)}if(this.mode===this.BACKSLASH){this.node.EditableSVGelem.classList.remove("invalid")}if(this.node.type==="mrow"){if(K==="\\"){if(this.mode!==this.BACKSLASH){this.mode=this.BACKSLASH;var u=j.mrow(j.mo(j.entity("#x005C")));u.backslashRow=true;this.node.data.splice(this.position,0,null);this.node.SetData(this.position,u);var A=u.cls?u.cls+" ":"";u.cls=A+"backslash-mode";s([this,function(){this.moveTo(u,1);this.refocus()}]);return}else{console.log("TODO: insert a \\")}}else{if(K==="^"||K==="_"){if(this.position===0){return}var F=this.node.data[this.position-1];var w=function(L,M){var N=j.hole();L.SetData(M,N);this.moveTo(N,0)}.bind(this);var v=(K==="_")?j.msubsup().sub:j.msubsup().sup;if(F.type==="msubsup"||F.type==="munderover"){if(F.data[v]){var y=F.data[v];if(y.cursorable){y.moveCursorFromParent(this,c)}else{this.moveTo(F,{section:v,pos:1})}}else{w(F,v)}}else{var B=j.msubsup();B.SetData(B.base,F);this.node.SetData(this.position-1,B);w(B,v)}s(["refocus",this]);return}else{if(K===" "){if(this.mode===this.BACKSLASH){var q="";for(var I=1;I<this.node.data.length;I++){var J=this.node.data[I];if(J.type!=="mi"){throw new Error("Found non-identifier in backslash expression")}var E=J.data[0];var K=E.data[0];q+=K}var r=this.makeParser();var C=r.parseControlSequence(q);if(!C){this.node.EditableSVGelem.classList.add("invalid");return}var D=this.node;var v=D.parent.data.indexOf(D);this.exitBackslashMode(C);s([this,function(){this.refocus()}]);return}else{this.node.moveCursor(this,"r");s([this,function(){this.refocus();this.mode=this.NORMAL}]);return}}}}if(f.letter.test(K)||f.number.test(K)){G=new j.mi(new j.chars(K))}else{if(f.remap[K]){G=new j.mo(new j.entity("#x"+f.remap[K]))}else{if(K==="+"||K==="/"||K==="="||K==="."||K==="("||K===")"){G=new j.mo(new j.chars(K))}}}}if(!G){return}this.node.data.splice(this.position,0,null);this.node.SetData(this.position,G);s([this,function(){this.move(i);this.refocus()}])},clearBoxes:function(){if(this.boxes){this.boxes.forEach(function(p){p.remove()})}this.boxes=[]},highlightBoxes:function(p){var r=this.node;this.clearBoxes();while(r){if(r.cursorable){var q=r.getSVGBBox();if(!q){return}this.boxes=this.boxes.concat(a.highlightBox(p,q))}r=r.parent}},findElement:function(){return document.getElementById("cursor-"+this.id)},findHighlight:function(){return document.getElementById("cursor-highlight-"+this.id)},drawAt:function(u,r,v,q,p){this.renderedPosition={x:r,y:v,height:q};var s=this.findElement();if(!s){s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("fill","#777777");s.setAttribute("class","math-cursor");s.id="cursor-"+this.id;u.appendChild(s)}else{var t=s.getAttribute("class");s.setAttribute("class",t.split("blink").join(""))}s.setAttribute("x",r);s.setAttribute("y",v);s.setAttribute("width",this.width);s.setAttribute("height",q);clearTimeout(this.startBlink);this.startBlink=setTimeout(function(){s.setAttribute("class",s.getAttribute("class")+" blink")}.bind(this),500);this.highlightBoxes(u);if(this.mode===this.SELECTION){if(this.selectionEnd.node.type==="mrow"){this.selectionEnd.node.drawCursorHighlight(this)}}jax=MathJax.Hub.getAllJax("#"+u.parentNode.id)[0];a.visualizeJax(jax,$("#mmlviz"),this);if(!p){this.scrollIntoView(u)}},clearHighlight:function(){this.mode=this.NORMAL;this.selectionStart=null;this.selectionEnd=null;this.hideHighlight()},hideHighlight:function(){var p=this.findHighlight();if(p){p.remove()}},drawHighlightAt:function(t,p,u,q,r){var s=this.findHighlight();if(!s){s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("fill","rgba(173, 216, 250, 0.5)");s.setAttribute("class","math-cursor-highlight");s.id="cursor-highlight-"+this.id;t.appendChild(s)}s.setAttribute("x",p);s.setAttribute("y",u);s.setAttribute("width",q);s.setAttribute("height",r)},scrollIntoView:function(z){if(!this.renderedPosition){return false}var u=this.renderedPosition.x;var s=this.renderedPosition.y;var w=this.renderedPosition.height;var p=a.elemCoordsToScreenCoords(z,u,s+w/2);var v=document.body.clientWidth;var q=document.body.clientHeight;var t=0,r=0;if(p.x<0||p.x>v){t=p.x-v/2}if(p.y<0||p.y>q){r=p.y-q/2}if(t||r){window.scrollBy(t,r)}},remove:function(){var p=this.findElement();if(p){p.remove()}},blur:function(p){this.remove();this.clearBoxes()},focus:function(){this.draw()},focusFirstHole:function(p){if(!p){return}if(p.type==="hole"){this.node=p;this.position=0;this.draw();return true}for(var q=0;q<p.data.length;q++){if(this.focusFirstHole(p.data[q])){return true}}return false}});e.Browser.Select({Opera:function(p){a.Augment({operaZoomRefresh:true})}});e.Register.StartupHook("End Cookie",function(){if(e.config.menuSettings.zoom!=="None"){k.Require("[MathJax]/extensions/MathZoom.js")}});if(!document.createElementNS){if(!document.namespaces.svg){document.namespaces.add("svg",b)}a.Augment({Element:function(p,q){var r=(typeof(p)==="string"?document.createElement("svg:"+p):p);r.isMathJax=true;if(q){for(var s in q){if(q.hasOwnProperty(s)){r.setAttribute(s,q[s].toString())}}}return r}})}})(MathJax.Ajax,MathJax.Hub,MathJax.HTML,MathJax.OutputJax.EditableSVG);
