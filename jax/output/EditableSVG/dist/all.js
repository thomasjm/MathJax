/*
 *  /MathJax/jax/output/EditableSVG/dist/all.js
 *
 *  Copyright (c) 2009-2015 The MathJax Consortium
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

var EditableSVGConfig=(function(){function a(){}a.config={linebreaks:null,merrorStyle:null,addMMLclasses:null,useFontCache:null,useGlobalCache:null,scale:null,mtextFontInherit:null,font:null,EqnChunk:null,EqnChunkDelay:null,styles:{".MathJax_SVG":{display:"inline","font-style":"normal","font-weight":"normal","line-height":"normal","font-size":"100%","font-size-adjust":"none","text-indent":0,"text-align":"left","text-transform":"none","letter-spacing":"normal","word-spacing":"normal","word-wrap":"normal","white-space":"nowrap","float":"none",direction:"ltr","max-width":"none","max-height":"none","min-width":0,"min-height":0,border:0,padding:0,margin:0},".MathJax_SVG_Display":{position:"relative",display:"block!important","text-indent":0,"max-width":"none","max-height":"none","min-width":0,"min-height":0,width:"100%"},".MathJax_SVG *":{transition:"none","-webkit-transition":"none","-moz-transition":"none","-ms-transition":"none","-o-transition":"none"},".mjx-svg-href":{fill:"blue",stroke:"blue"},".MathJax_SVG_Processing":{visibility:"hidden",position:"absolute",top:0,left:0,width:0,height:0,overflow:"hidden",display:"block!important"},".MathJax_SVG_Processed":{display:"none!important"},".MathJax_SVG_ExBox":{display:"block!important",overflow:"hidden",width:"1px",height:"60ex","min-height":0,"max-height":"none",padding:0,border:0,margin:0},"#MathJax_SVG_Tooltip":{position:"absolute",left:0,top:0,width:"auto",height:"auto",display:"none"}}};return a})();var EditableSVG=(function(){function a(){this.AJAX=MathJax.AJAX;this.HUB=MathJax.Hub;this.HTML=MathJax.HTML;this.SVG=MathJax.OutputJax.EditableSVG;this.TOUCH=undefined;this.config=EditableSVGConfig.config;this.hideProcessedMath=true;this.fontNames=["TeX","STIX","STIX-Web","Asana-Math","Gyre-Termes","Gyre-Pagella","Latin-Modern","Neo-Euler"];this.TextNode=this.HTML.TextNode;this.addText=this.HTML.addText;this.ucMatch=this.HTML.ucMatch;this.HUB.Register.StartupHook("mml Jax Ready",function(){MML=MathJax.ElementJax.mml;this.MML.mbase.Augment(MBaseMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.chars.Augment(CharsMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.entity.Augment(EntityMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mo.Augment(MoMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mtext.Augment(MTextMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.merror.Augment(MErrorMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.ms.Augment(MsMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mglyph.Augment(MGlyphMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mspace.Augment(MSpaceMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mphantom.Augment(MPhantomMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mpadded.Augment(MPaddedMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mrow.Augment(MRowMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mstyle.Augment(MStyleMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mfrac.Augment(MFracMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.msqrt.Augment(MSqrtMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mroot.Augment(MRootMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mfenced.Augment(MFencedMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.menclose.Augment(MEncloseMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.maction.Augment(MActionMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.semantics.Augment(SemanticsMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.munderover.Augment(MUnderOverMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.msubsup.Augment(MSubSupMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mmultiscripts.Augment(MMultiScriptsMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.mtable.Augment(MTableMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.math.Augment(MathMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML.TeXAtom.Augment(TeXAtomMixin.getMethods(this.AJAX,this.HUB,this.HTML,this.MML,this));this.MML["annotation-xml"].Augment({toSVG:this.MML.mbase.SVGautoload});this.HUB.Register.StartupHook("onLoad",function(){setTimeout(MathJax.Callback(["loadComplete",a,"jax.js"]),0)})});this.HUB.Browser.Select({Opera:function(b){this.EditableSVG.Augment({operaZoomRefresh:true})}});this.HUB.Register.StartupHook("End Cookie",function(){if(this.HUB.config.menuSettings.zoom!=="None"){this.AJAX.Require("[MathJax]/extensions/MathZoom.js")}});if(!document.createElementNS){if(!document.namespaces.svg){document.namespaces.add("svg",Util.SVGNS)}}}a.prototype.Config=function(){this.SUPER(arguments).Config.apply(this,arguments);var d=this.HUB.config.menuSettings,c=this.config,b=d.font;if(d.scale){c.scale=d.scale}if(b&&b!=="Auto"){b=b.replace(/(Local|Web|Image)$/i,"");b=b.replace(/([a-z])([A-Z])/,"$1-$2");this.fontInUse=b}else{this.fontInUse=c.font||"TeX"}if(this.fontNames.indexOf(this.fontInUse)<0){this.fontInUse="TeX"}this.fontDir+="/"+this.fontInUse;if(!this.require){this.require=[]}this.require.push(this.fontDir+"/fontdata.js");this.require.push(MathJax.OutputJax.extensionDir+"/MathEvents.js")};a.prototype.Startup=function(){var c=MathJax.Extension.MathEvents.Event;this.TOUCH=MathJax.Extension.MathEvents.Touch;var b=MathJax.Extension.MathEvents.Hover;this.ContextMenu=c.ContextMenu;this.Mouseover=b.Mouseover;this.Mouseout=b.Mouseout;this.Mousemove=b.Mousemove;this.hiddenDiv=this.HTML.Element("div",{style:{visibility:"hidden",overflow:"hidden",position:"absolute",top:0,height:"1px",width:"auto",padding:0,border:0,margin:0,textAlign:"left",textIndent:0,textTransform:"none",lineHeight:"normal",letterSpacing:"normal",wordSpacing:"normal"}});if(!document.body.firstChild){document.body.appendChild(this.hiddenDiv)}else{document.body.insertBefore(this.hiddenDiv,document.body.firstChild)}this.hiddenDiv=this.HTML.addElement(this.hiddenDiv,"div",{id:"MathJax_SVG_Hidden"});var d=this.HTML.addElement(this.hiddenDiv,"div",{style:{width:"5in"}});Util.pxPerInch=d.offsetWidth/5;this.hiddenDiv.removeChild(d);this.textSVG=this.Element("svg");BBOX_GLYPH.defs=this.addElement(this.addElement(this.hiddenDiv.parentNode,"svg"),"defs",{id:"MathJax_SVG_glyphs"});this.ExSpan=this.HTML.Element("span",{style:{position:"absolute","font-size-adjust":"none"}},[["span",{className:"MathJax_SVG_ExBox"}]]);this.linebreakSpan=this.HTML.Element("span",null,[["hr",{style:{width:"auto",size:1,padding:0,border:0,margin:0}}]]);return this.AJAX.Styles(this.config.styles,["InitializeSVG",this])};a.prototype.InitializeSVG=function(){document.body.appendChild(this.ExSpan);document.body.appendChild(this.linebreakSpan);this.defaultEx=this.ExSpan.firstChild.offsetHeight/60;this.defaultWidth=this.linebreakSpan.firstChild.offsetWidth;document.body.removeChild(this.linebreakSpan);document.body.removeChild(this.ExSpan)};a.prototype.preTranslate=function(e){var k=e.jax[this.id],l,h=k.length,r,j,s,d,q,c,p,g,b,o=false,n,t=this.config.linebreaks.automatic,f=this.config.linebreaks.width;if(t){o=(f.match(/^\s*(\d+(\.\d*)?%\s*)?container\s*$/)!=null);if(o){f=f.replace(/\s*container\s*/,"")}else{b=this.defaultWidth}if(f===""){f="100%"}}else{b=100000}for(l=0;l<h;l++){r=k[l];if(!r.parentNode){continue}j=r.previousSibling;if(j&&String(j.className).match(/^MathJax(_SVG)?(_Display)?( MathJax(_SVG)?_Processing)?$/)){j.parentNode.removeChild(j)}c=r.MathJax.elementJax;if(!c){continue}c.SVG={display:(c.root.Get("display")==="block")};s=d=this.HTML.Element("span",{style:{"font-size":this.config.scale+"%",display:"inline-block"},className:"MathJax_SVG",id:c.inputID+"-Frame",isMathJax:true,jaxID:this.id,oncontextmenu:this.EVENT.Menu,onmousedown:this.EVENT.Mousedown,onmouseover:this.EVENT.Mouseover,onmouseout:this.EVENT.Mouseout,onmousemove:this.EVENT.Mousemove,onclick:this.EVENT.Click,ondblclick:this.EVENT.DblClick});if(this.HUB.Browser.noContextMenu){s.ontouchstart=this.TOUCH.start;s.ontouchend=this.TOUCH.end}if(c.SVG.display){d=this.HTML.Element("div",{className:"MathJax_SVG_Display"});d.appendChild(s)}d.className+=" MathJax_SVG_Processing";r.parentNode.insertBefore(d,r);r.parentNode.insertBefore(this.ExSpan.cloneNode(true),r);d.parentNode.insertBefore(this.linebreakSpan.cloneNode(true),d)}for(l=0;l<h;l++){r=k[l];if(!r.parentNode){continue}q=r.previousSibling;d=q.previousSibling;c=r.MathJax.elementJax;if(!c){continue}p=q.firstChild.offsetHeight/60;n=d.previousSibling.firstChild.offsetWidth;if(o){b=n}if(p===0||p==="NaN"){this.hiddenDiv.appendChild(d);c.SVG.isHidden=true;p=this.defaultEx;n=this.defaultWidth;if(o){b=n}}c.SVG.ex=p;c.SVG.em=g=p/Util.TeX.x_height*1000;c.SVG.cwidth=n/g*1000;c.SVG.lineWidth=(t?this.length2em(f,1,b/g*1000):Util.BIGDIMEN)}for(l=0;l<h;l++){r=k[l];if(!r.parentNode){continue}q=k[l].previousSibling;s=q.previousSibling;c=k[l].MathJax.elementJax;if(!c){continue}if(!c.SVG.isHidden){s=s.previousSibling}s.parentNode.removeChild(s);q.parentNode.removeChild(q)}e.SVGeqn=e.SVGlast=0;e.SVGi=-1;e.SVGchunk=this.config.EqnChunk;e.SVGdelay=false};a.prototype.Translate=function(c,g){if(!c.parentNode){return}if(g.SVGdelay){g.SVGdelay=false;this.HUB.RestartAfter(MathJax.Callback.Delay(this.config.EqnChunkDelay))}var b=c.MathJax.elementJax,f=b.root,d=document.getElementById(b.inputID+"-Frame"),i=(b.SVG.display?(d||{parentNode:undefined}).parentNode:d),h=(a.config.useFontCache&&!a.config.useGlobalCache);if(!i){return}this.em=this.MML.mbase.prototype.em=b.SVG.em;this.ex=b.SVG.ex;this.linebreakWidth=b.SVG.lineWidth;this.cwidth=b.SVG.cwidth;this.mathDiv=i;d.appendChild(this.textSVG);if(h){this.resetGlyphs()}this.initSVG(f,d);f.setTeXclass();try{f.toSVG(d,i)}catch(e){if(e.restart){while(d.firstChild){d.removeChild(d.firstChild)}}if(h){BBOX_GLYPH.n--}throw e}d.removeChild(this.textSVG);if(b.SVG.isHidden){c.parentNode.insertBefore(i,c)}i.className=i.className.split(/ /)[0];if(this.hideProcessedMath){i.className+=" MathJax_SVG_Processed";if(c.MathJax.preview){b.SVG.preview=c.MathJax.preview;delete c.MathJax.preview}g.SVGeqn+=(g.i-g.SVGi);g.SVGi=g.i;if(g.SVGeqn>=g.SVGlast+g.SVGchunk){this.postTranslate(g,true);g.SVGchunk=Math.floor(g.SVGchunk*this.config.EqnChunkFactor);g.SVGdelay=true}}};a.prototype.postTranslate=function(h,e){var c=h.jax[this.id];if(!this.hideProcessedMath){return}for(var f=h.SVGlast,b=h.SVGeqn;f<b;f++){var d=c[f];if(d&&d.MathJax.elementJax){d.previousSibling.className=d.previousSibling.className.split(/ /)[0];var g=d.MathJax.elementJax.SVG;if(g.preview){g.preview.innerHTML="";d.MathJax.preview=g.preview;delete g.preview}}}h.SVGlast=h.SVGeqn};a.prototype.resetGlyphs=function(c){if(this.config.useFontCache){var b=BBOX_GLYPH;if(this.config.useGlobalCache){b.defs=document.getElementById("MathJax_SVG_glyphs");b.defs.innerHTML=""}else{b.defs=this.Element("defs");b.n++}b.glyphs={};if(c){b.n=0}}};a.prototype.getJaxFromMath=function(b){if(b.parentNode.className==="MathJax_SVG_Display"){b=b.parentNode}do{b=b.nextSibling}while(b&&b.nodeName.toLowerCase()!=="script");return this.HUB.getJaxFor(b)};a.prototype.getHoverSpan=function(b,c){c.style.position="relative";return c.firstChild};a.prototype.getHoverBBox=function(b,c,d){var e=this.EVENT.getBBox(c.parentNode);e.h+=2;e.d-=2;return e};a.prototype.Zoom=function(c,l,k,b,i){l.className="MathJax_SVG";var n=l.appendChild(this.ExSpan.cloneNode(true));var h=n.firstChild.offsetHeight/60;this.em=this.MML.mbase.prototype.em=h/Util.TeX.x_height*1000;this.ex=h;this.linebreakWidth=c.SVG.lineWidth;this.cwidth=c.SVG.cwidth;n.parentNode.removeChild(n);l.appendChild(this.textSVG);this.mathDIV=l;this.zoomScale=parseInt(this.HUB.config.menuSettings.zscale)/100;var g=c.root.data[0].EditableSVGdata.tw;if(g&&g<this.cwidth){this.cwidth=g}this.idPostfix="-zoom";c.root.toSVG(l,l);this.idPostfix="";this.zoomScale=1;l.removeChild(this.textSVG);var f=l.getElementsByTagName("svg")[0].style;f.marginTop=f.marginRight=f.marginLeft=0;if(f.marginBottom.charAt(0)==="-"){l.style.marginBottom=f.marginBottom.substr(1)}if(this.operaZoomRefresh){setTimeout(function(){l.firstChild.style.border="1px solid transparent"},1)}if(l.offsetWidth<l.firstChild.offsetWidth){l.style.minWidth=l.firstChild.offsetWidth+"px";k.style.minWidth=k.firstChild.offsetWidth+"px"}l.style.position=k.style.position="absolute";var j=l.offsetWidth,e=l.offsetHeight,m=k.offsetHeight,d=k.offsetWidth;l.style.position=k.style.position="";return{Y:-this.EVENT.getBBox(l).h,mW:d,mH:m,zW:j,zH:e}};a.prototype.initSVG=function(c,b){};a.prototype.Remove=function(b){var c=document.getElementById(b.inputID+"-Frame");if(c){if(b.SVG.display){c=c.parentNode}c.parentNode.removeChild(c)}delete b.SVG};a.prototype.addElement=function(c,b,d){return c.appendChild(this.Element(b,d))};a.prototype.HandleVariant=function(j,h,u){var o=new BBOX_G();var e,q,s,f,t,k,g,d,r,b;if(!j){j=this.FONTDATA.VARIANT[this.MML.VARIANT.NORMAL]}if(j.forceFamily){u=new BBOX_TEXT(this.HTML,h,u,j.font);if(j.h!==null){u.h=j.h}if(j.d!==null){u.d=j.d}o.Add(u);u=""}t=j;for(k=0,g=u.length;k<g;k++){j=t;e=u.charCodeAt(k);s=u.charAt(k);if(e>=55296&&e<56319){k++;e=(((e-55296)<<10)+(u.charCodeAt(k)-56320))+65536;if(this.FONTDATA.RemapPlane1){var p=this.FONTDATA.RemapPlane1(e,j);e=p.n;j=p.variant}}else{b=this.FONTDATA.RANGES;for(d=0,r=b.length;d<r;d++){if(b[d].name==="alpha"&&j.noLowerCase){continue}q=j["offset"+b[d].offset];if(q&&e>=b[d].low&&e<=b[d].high){if(b[d].remap&&b[d].remap[e]){e=q+b[d].remap[e]}else{e=e-b[d].low+q;if(b[d].add){e+=b[d].add}}if(j["variant"+b[d].offset]){j=this.FONTDATA.VARIANT[j["variant"+b[d].offset]]}break}}}if(j.remap&&j.remap[e]){e=j.remap[e];if(j.remap.variant){j=this.FONTDATA.VARIANT[j.remap.variant]}}else{if(this.FONTDATA.REMAP[e]&&!j.noRemap){e=this.FONTDATA.REMAP[e]}}if(e instanceof Array){j=this.FONTDATA.VARIANT[e[1]];e=e[0]}if(typeof(e)==="string"){u=e+u.substr(k+1);g=u.length;k=-1;continue}f=this.lookupChar(j,e);s=f[e];if(s){if((s[5]&&s[5].space)||(s[5]===""&&s[0]+s[1]===0)){o.w+=s[2]}else{s=[h,f.id+"-"+e.toString(16).toUpperCase()].concat(s);o.Add(BBOX_GLYPH.apply(BBOX,s),o.w,0)}}else{if(this.FONTDATA.DELIMITERS[e]){s=this.createDelimiter(e,0,1,f);o.Add(s,o.w,(this.FONTDATA.DELIMITERS[e].dir==="V"?s.d:0))}else{if(e<=65535){s=String.fromCharCode(e)}else{q=e-65536;s=String.fromCharCode((q>>10)+55296)+String.fromCharCode((q&1023)+56320)}var l=new BBOX_TEXT(this.HTML,h*100/SVG.config.scale,s,{"font-family":j.defaultFamily||SVG.config.undefinedFamily,"font-style":(j.italic?"italic":""),"font-weight":(j.bold?"bold":"")});if(j.h!==null){l.h=j.h}if(j.d!==null){l.d=j.d}s=new BBOX_G();s.Add(l);o.Add(s,o.w,0);this.HUB.signal.Post(["SVG Jax - unknown char",e,j])}}return o}if(u.length==1&&f.skew&&f.skew[e]){o.skew=f.skew[e]*1000}if(o.element.childNodes.length===1){o.element=o.element.firstChild;o.removeable=false;o.scale=h}return o};a.lookupChar=function(e,h){var d,b;if(!e.FONTS){var g=this.FONTDATA.FONTS;var f=(e.fonts||this.FONTDATA.VARIANT.normal.fonts);if(!(f instanceof Array)){f=[f]}if(e.fonts!=f){e.fonts=f}e.FONTS=[];for(d=0,b=f.length;d<b;d++){if(g[f[d]]){e.FONTS.push(g[f[d]])}}}for(d=0,b=e.FONTS.length;d<b;d++){var c=e.FONTS[d];if(typeof(c)==="string"){delete e.FONTS;this.loadFont(c)}if(c[h]){return c}else{this.findBlock(c,h)}}return{id:"unknown"}};a.findBlock=function(d,h){if(d.Ranges){for(var g=0,b=d.Ranges.length;g<b;g++){if(h<d.Ranges[g][0]){return}if(h<=d.Ranges[g][1]){var f=d.Ranges[g][2];for(var e=d.Ranges.length-1;e>=0;e--){if(d.Ranges[e][2]==f){d.Ranges.splice(e,1)}}this.loadFont(d.directory+"/"+f+".js")}}}};a.loadFont=function(b){this.HUB.RestartAfter(this.AJAX.Require(this.fontDir+"/"+b))};a.prototype.createDelimiter=function(b,d,g,e){if(g===void 0){g=null}if(e===void 0){e=null}if(!g){g=1}var j=new BBOX_G();if(!b){j.Clean();delete j.element;j.w=j.r=Util.TeX.nulldelimiterspace*g;return j}if(!(d instanceof Array)){d=[d,d]}var k=d[1];d=d[0];var c={alias:b,HW:undefined,load:undefined,stretch:undefined};while(c.alias){b=c.alias;c=this.FONTDATA.DELIMITERS[b];if(!c){c={HW:[0,this.FONTDATA.VARIANT[this.MML.VARIANT.NORMAL]]}}}if(c.load){this.HUB.RestartAfter(this.AJAX.Require(this.fontDir+"/fontdata-"+c.load+".js"))}for(var h=0,f=c.HW.length;h<f;h++){if(c.HW[h][0]*g>=d-10-a.config.blacker||(h==f-1&&!c.stretch)){if(c.HW[h][2]){g*=c.HW[h][2]}if(c.HW[h][3]){b=c.HW[h][3]}return this.createChar(g,[b,c.HW[h][1]],e).With({stretched:true},this.HUB)}}if(c.stretch){this["extendDelimiter"+c.dir](j,k,c.stretch,g,e)}return j};a.createChar=function(j,g,d){var h="",f={fonts:[g[1]],noRemap:true};if(d&&d===this.MML.VARIANT.BOLD){f.fonts=[g[1]+"-bold",g[1]]}if(typeof(g[1])!=="string"){f=g[1]}if(g[0] instanceof Array){for(var e=0,b=g[0].length;e<b;e++){h+=String.fromCharCode(g[0][e])}}else{h=String.fromCharCode(g[0])}if(g[4]){j=j*g[4]}var c=this.HandleVariant(f,j,h);if(g[2]){c.x=g[2]*1000}if(g[3]){c.y=g[3]*1000}if(g[5]){c.h+=g[5]*1000}if(g[6]){c.d+=g[6]*1000}return c};a.extendDelimiterV=function(j,r,c,e,d){var p=this.createChar(e,(c.top||c.ext),d);var m=this.createChar(e,(c.bot||c.ext),d);var i=p.h+p.d+m.h+m.d;var o=-p.h;j.Add(p,0,o);o-=p.d;if(c.mid){var q=this.createChar(e,c.mid,d);i+=q.h+q.d}if(c.min&&r<i*c.min){r=i*c.min}if(r>i){var b=this.createChar(e,c.ext,d);var f=(c.mid?2:1),n=(r-i)/f,t=(n+100)/(b.h+b.d);while(f-->0){var l=a.Element("g",{transform:"translate("+b.y+","+(o-t*b.h+50+b.y)+") scale(1,"+t+")"});l.appendChild(b.element.cloneNode(false));j.element.appendChild(l);o-=n;if(c.mid&&f){j.Add(q,0,o-q.h);o-=(q.h+q.d)}}}else{if(c.mid){o+=(i-r)/2;j.Add(q,0,o-q.h);o+=-(q.h+q.d)+(i-r)/2}else{o+=(i-r)}}j.Add(m,0,o-m.h);j.Clean();j.scale=e;j.isMultiChar=true};a.extendDelimiterH=function(j,e,c,h,d){var f=this.createChar(h,(c.left||c.rep),d);var r=this.createChar(h,(c.right||c.rep),d);j.Add(f,-f.l,0);var q=(f.r-f.l)+(r.r-r.l),o=f.r-f.l;if(c.mid){var p=this.createChar(h,c.mid,d);q+=p.w}if(c.min&&e<q*c.min){e=q*c.min}if(e>q){var n=this.createChar(h,c.rep,d),b=c.fuzz||0;var i=(c.mid?2:1),m=(e-q)/i,t=(m+b)/(n.r-n.l);while(i-->0){var l=SVG.Element("g",{transform:"translate("+(o-b/2-t*n.l+n.x)+","+n.y+") scale("+t+",1)"});l.appendChild(n.element.cloneNode(false));j.element.appendChild(l);o+=m;if(c.mid&&i){j.Add(p,o,0);o+=p.w}}}else{if(c.mid){o-=(q-e)/2;j.Add(p,o,0);o+=p.w-(q-e)/2}else{o-=(q-e)}}j.Add(r,o-r.l,0);j.Clean();j.scale=h;j.isMultiChar=true};a.Element=function(b,c){var d=(typeof(b)==="string"?document.createElement("svg:"+b):b);d.isMathJax=true;if(c){for(var e in c){if(c.hasOwnProperty(e)){d.setAttribute(e,c[e].toString())}}}return d};return a})();var Util=(function(){function a(){}a.prototype.Em=function(b){if(Math.abs(b)<0.0006){return"0em"}return b.toFixed(3).replace(/\.?0+$/,"")+"em"};a.prototype.Ex=function(b){b=Math.round(b/this.TeX.x_height*this.ex)/this.ex;if(Math.abs(b)<0.0006){return"0ex"}return b.toFixed(3).replace(/\.?0+$/,"")+"ex"};a.prototype.Percent=function(b){return(100*b).toFixed(1).replace(/\.?0+$/,"")+"%"};a.Fixed=function(b,c){if(Math.abs(b)<0.0006){return"0"}return b.toFixed(c||3).replace(/\.?0+$/,"")};a.hashCheck=function(b){if(b&&b.nodeName.toLowerCase()==="g"){do{b=b.parentNode}while(b&&b.firstChild.nodeName!=="svg")}return b};a.prototype.Element=function(b,c){var d=(typeof(b)==="string"?document.createElementNS(a.SVGNS,b):b);d.isMathJax=true;if(c){for(var e in c){if(c.hasOwnProperty(e)){d.setAttribute(e,c[e].toString())}}}return d};a.length2em=function(g,c,e){if(c===void 0){c=null}if(e===void 0){e=null}if(typeof(g)!=="string"){g=g.toString()}if(g===""){return""}if(g===this.MML.SIZE.NORMAL){return 1000}if(g===this.MML.SIZE.BIG){return 2000}if(g===this.MML.SIZE.SMALL){return 710}if(g==="infinity"){return this.BIGDIMEN}if(g.match(/mathspace$/)){return 1000*this.MATHSPACE[g]}var h=(EditableSVG.zoomScale||1)/a.em;var d=g.match(/^\s*([-+]?(?:\.\d+|\d+(?:\.\d*)?))?(pt|em|ex|mu|px|pc|in|mm|cm|%)?/);var b=parseFloat(d[1]||"1")*1000,f=d[2];if(e==null){e=1000}if(c==null){c=1}if(f==="em"){return b}if(f==="ex"){return b*this.TeX.x_height/1000}if(f==="%"){return b/100*e/1000}if(f==="px"){return b*h}if(f==="pt"){return b/10}if(f==="pc"){return b*1.2}if(f==="in"){return b*this.pxPerInch*h}if(f==="cm"){return b*this.pxPerInch*h/2.54}if(f==="mm"){return b*this.pxPerInch*h/25.4}if(f==="mu"){return b/18*c}return b*e/1000};a.getPadding=function(c){var e={top:0,right:0,bottom:0,left:0};var b=false;for(var f in e){if(e.hasOwnProperty(f)){var d=c["padding"+f.charAt(0).toUpperCase()+f.substr(1)];if(d){e[f]=a.length2em(d);b=true}}}return(b?e:false)};a.getBorders=function(f){var d={top:0,right:0,bottom:0,left:0},c=false;for(var g in d){if(d.hasOwnProperty(g)){var b="border"+g.charAt(0).toUpperCase()+g.substr(1);var e=f[b+"Style"];if(e&&e!=="none"){c=true;d[g]=a.length2em(f[b+"Width"]);d[g+"Style"]=f[b+"Style"];d[g+"Color"]=f[b+"Color"];if(d[g+"Color"]==="initial"){d[g+"Color"]=""}}else{delete d[g]}}}return(c?d:false)};a.thickness2em=function(c,b){var d=this.TeX.rule_thickness;if(c===this.MML.LINETHICKNESS.MEDIUM){return d}if(c===this.MML.LINETHICKNESS.THIN){return 0.67*d}if(c===this.MML.LINETHICKNESS.THICK){return 1.67*d}return this.length2em(c,b,d)};a.SVGNS="http://www.w3.org/2000/svg";a.XLINKNS="http://www.w3.org/1999/xlink";a.NBSP="\u00A0";a.BIGDIMEN=10000000;a.TeX={x_height:430.554,quad:1000,num1:676.508,num2:393.732,num3:443.73,denom1:685.951,denom2:344.841,sup1:412.892,sup2:362.892,sup3:288.888,sub1:150,sub2:247.217,sup_drop:386.108,sub_drop:50,delim1:2390,delim2:1000,axis_height:250,rule_thickness:60,big_op_spacing1:111.111,big_op_spacing2:166.666,big_op_spacing3:200,big_op_spacing4:600,big_op_spacing5:100,scriptspace:100,nulldelimiterspace:120,delimiterfactor:901,delimitershortfall:300,min_rule_thickness:1.25,min_root_space:1.5};a.MATHSPACE={veryverythinmathspace:1/18,verythinmathspace:2/18,thinmathspace:3/18,mediummathspace:4/18,thickmathspace:5/18,verythickmathspace:6/18,veryverythickmathspace:7/18,negativeveryverythinmathspace:-1/18,negativeverythinmathspace:-2/18,negativethinmathspace:-3/18,negativemediummathspace:-4/18,negativethickmathspace:-5/18,negativeverythickmathspace:-6/18,negativeveryverythickmathspace:-7/18};return a})();var BBOX=(function(){function a(b){if(b===void 0){b=null}this.type="g";this.removeable=true;this.glyphs={};this.h=this.d=-Util.BIGDIMEN;this.H=this.D=0;this.w=this.r=0;this.l=Util.BIGDIMEN;this.x=this.y=0;this.scale=1;this.EditableSVG=svg;if(this.type){this.element=EditableSVG.Element(this.type,b)}}a.prototype.With=function(c,b){return b.Insert(this,c)};a.prototype.Add=function(d,j,i,b,h){if(j){d.x+=j}if(i){d.y+=i}if(d.element){if(d.removeable&&d.element.childNodes.length===1&&d.n===1){var c=d.element.firstChild,f=c.nodeName.toLowerCase();if(f==="use"||f==="rect"){d.element=c;d.scale=d.childScale;var g=d.childX,e=d.childY;d.x+=g;d.y+=e;d.h-=e;d.d+=e;d.H-=e;d.D+=e;d.w-=g;d.r-=g;d.l+=g;d.removeable=false;c.setAttribute("x",Math.floor(d.x/d.scale));c.setAttribute("y",Math.floor(d.y/d.scale))}}if(Math.abs(d.x)<1&&Math.abs(d.y)<1){d.remove=d.removeable}else{f=d.element.nodeName.toLowerCase();if(f==="g"){if(!d.element.firstChild){d.remove=d.removeable}else{d.element.setAttribute("transform","translate("+Math.floor(d.x)+","+Math.floor(d.y)+")")}}else{if(f==="line"||f==="polygon"||f==="path"||f==="a"){d.element.setAttribute("transform","translate("+Math.floor(d.x)+","+Math.floor(d.y)+")")}else{d.element.setAttribute("x",Math.floor(d.x/d.scale));d.element.setAttribute("y",Math.floor(d.y/d.scale))}}}if(d.remove){this.n+=d.n;while(d.element.firstChild){if(h&&this.element.firstChild){this.element.insertBefore(d.element.firstChild,this.element.firstChild)}else{this.element.appendChild(d.element.firstChild)}}}else{if(h){this.element.insertBefore(d.element,this.element.firstChild)}else{this.element.appendChild(d.element)}}delete d.element}if(d.hasIndent){this.hasIndent=d.hasIndent}if(d.tw!=null){this.tw=d.tw}if(d.d-d.y>this.d){this.d=d.d-d.y;if(this.d>this.D){this.D=this.d}}if(d.y+d.h>this.h){this.h=d.y+d.h;if(this.h>this.H){this.H=this.h}}if(d.D-d.y>this.D){this.D=d.D-d.y}if(d.y+d.H>this.H){this.H=d.y+d.H}if(d.x+d.l<this.l){this.l=d.x+d.l}if(d.x+d.r>this.r){this.r=d.x+d.r}if(b||d.x+d.w+(d.X||0)>this.w){this.w=d.x+d.w+(d.X||0)}this.childScale=d.scale;this.childX=d.x;this.childY=d.y;this.n++;return d};a.prototype.Align=function(f,g,e,d,c){if(c===void 0){c=null}e=({left:e,center:(this.w-f.w)/2,right:this.w-f.w-e})[g]||0;var b=this.w;this.Add(f,e+(c||0),d);this.w=b};a.prototype.Clean=function(){if(this.h===-Util.BIGDIMEN){this.h=this.d=this.l=0}return this};a.defs=null;a.n=0;return a})();var __extends=(this&&this.__extends)||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}c.prototype=a.prototype;f.prototype=new c()};var BBOX_FRAME=(function(b){__extends(a,b);function a(g,j,l,m,f,e,i,k,c){this.type="rect";this.removeable=false;if(c==null){c={}}c.fill="none";c["stroke-width"]=Util.Fixed(m,2);c.width=Math.floor(l-m);c.height=Math.floor(g+j-m);c.transform="translate("+Math.floor(m/2)+","+Math.floor(-j+m/2)+")";if(f==="dashed"){c["stroke-dasharray"]=[Math.floor(6*Util.em),Math.floor(6*Util.em)].join(" ")}b.call(this,c);this.w=this.r=l;this.h=this.H=g;this.d=this.D=j;this.l=0}return a})(BBOX);var BBOX_G=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}return a})(BBOX);var BBOX_GLYPH=(function(a){__extends(b,a);function b(n,g,q,s,u,o,f,i,e,m){this.type="path";this.removeable=false;var j;var v=e.config.blacker;var c=e.config.useFontCache;var k=(n===1?null:"scale("+e.Fixed(n)+")");if(c&&!e.config.useGlobalCache){g="E"+this.n+"-"+g}if(!c||!this.glyphs[g]){j={"stroke-width":v};if(c){j.id=g}else{if(k){j.transform=k}}j.d=(i?"M"+i+"Z":"");a.call(this,j);if(c){BBOX.defs.appendChild(this.element);this.glyphs[g]=true}}if(c){j={};if(k){j.transform=k}this.element=e.Element("use",j);this.element.setAttributeNS(Util.XLINKNS,"href","#"+g)}this.h=(q+v)*n;this.d=(s+v)*n;this.w=(u+v/2)*n;this.l=(o+v/2)*n;this.r=(f+v/2)*n;this.H=Math.max(0,this.h);this.D=Math.max(0,this.d);this.x=this.y=0;this.scale=n}return b})(BBOX);var BBOX_HLINE=(function(b){__extends(a,b);function a(d,f,h,e,g){this.type="line";this.removeable=false;if(g==null){g={"stroke-linecap":"square"}}if(e&&e!==""){g.stroke=e}g["stroke-width"]=Util.Fixed(f,2);g.x1=g.y1=g.y2=Math.floor(f/2);g.x2=Math.floor(d-f/2);if(h==="dashed"){var i=Math.floor(Math.max(0,d-f)/(6*f)),c=Math.floor(Math.max(0,d-f)/(2*i+1));g["stroke-dasharray"]=c+" "+c}if(h==="dotted"){g["stroke-dasharray"]=[1,Math.max(150,Math.floor(2*f))].join(" ");g["stroke-linecap"]="round"}b.call(this,g);this.w=this.r=d;this.l=0;this.h=this.H=f;this.d=this.D=0}return a})(BBOX);var BBOX_NONREMOVABLE=(function(b){__extends(a,b);function a(){b.apply(this,arguments);this.type="svg";this.removeable=false}return a})(BBOX);var BBOX_NULL=(function(b){__extends(a,b);function a(){var c=[];for(var d=0;d<arguments.length;d++){c[d-0]=arguments[d]}b.call(this);this.Clean()}return a})(BBOX);var BBOX_RECT=(function(a){__extends(b,a);function b(e,g,c,f){if(f===void 0){f=null}this.type="rect";this.removeable=false;if(f==null){f={stroke:"none"}}f.width=Math.floor(c);f.height=Math.floor(e+g);a.call(this,f);this.w=this.r=c;this.h=this.H=e+g;this.d=this.D=this.l=0;this.y=-g}return b})(BBOX);var BBOX_ROW=(function(b){__extends(a,b);function a(c){b.call(this);this.editableSVG=c;this.sh=this.sd=0}a.prototype.Check=function(d){var c=d.toSVG();this.editableSVG.push(c);if(d.SVGcanStretch("Vertical")){c.mml=d}if(c.h>this.sh){this.sh=c.h}if(c.d>this.sd){this.sd=c.d}return c};a.prototype.Stretch=function(){for(var f=0,c=this.editableSVG.length;f<c;f++){var d=this.editableSVG[f],e=d.mml;if(e){if(e.forceStretch||e.EditableSVGdata.h!==this.sh||e.EditableSVGdata.d!==this.sd){d=e.SVGstretchV(this.sh,this.sd)}e.EditableSVGdata.HW=this.sh;e.EditableSVGdata.D=this.sd}if(d.ic){this.ic=d.ic}else{delete this.ic}this.Add(d,this.w,0,true)}delete this.editableSVG};return a})(BBOX);var BBOX_TEXT=(function(b){__extends(a,b);function a(g,f,e,c){this.type="text";this.removeable=false;if(!c){c={}}c.stroke="none";if(c["font-style"]===""){delete c["font-style"]}if(c["font-weight"]===""){delete c["font-weight"]}b.call(this,c);g.addText(this.element,e);this.EditableSVG.textSVG.appendChild(this.element);var d=this.element.getBBox();this.EditableSVG.textSVG.removeChild(this.element);f*=1000/Util.em;this.element.setAttribute("transform","scale("+Util.Fixed(f)+") matrix(1 0 0 -1 0 0)");this.w=this.r=d.width*f;this.l=0;this.h=this.H=-d.y*f;this.d=this.D=(d.height+d.y)*f}return a})(BBOX);var BBOX_VLINE=(function(a){__extends(b,a);function b(f,e,i,d,g){this.type="line";this.removeable=false;if(g==null){g={"stroke-linecap":"square"}}if(d&&d!==""){g.stroke=d}g["stroke-width"]=Util.Fixed(e,2);g.x1=g.x2=g.y1=Math.floor(e/2);g.y2=Math.floor(f-e/2);if(i==="dashed"){var j=Math.floor(Math.max(0,f-e)/(6*e)),c=Math.floor(Math.max(0,f-e)/(2*j+1));g["stroke-dasharray"]=c+" "+c}if(i==="dotted"){g["stroke-dasharray"]=[1,Math.max(150,Math.floor(2*e))].join(" ");g["stroke-linecap"]="round"}a.call(this,g);this.w=this.r=e;this.l=0;this.h=this.H=f;this.d=this.D=0}return b})(BBOX);var ElementJax=(function(){function a(){}return a})();var MBaseMixin=(function(a){__extends(b,a);function b(c){a.call(this);this.AJAX=c}b.prototype.getBB=function(c){var d=this.EditableSVGelem;if(!d){console.log("Oh no! Couldn't find elem for this");return}return d.getBBox()};b.getMethods=function(e,f,g,d,h){var c={AJAX:e,HUB:f,HTML:g,MML:d,editableSVG:h}};b.prototype.toSVG=function(){this.SVGgetStyles();var f=this.SVGgetVariant();var d=new BBOX();this.SVGgetScale(d);this.SVGhandleSpace(d);for(var e=0,c=this.data.length;e<c;e++){if(this.data[e]){var h=d.Add(this.data[e].toSVG(f,d.scale),d.w,0,true);if(h.skew){d.skew=h.skew}}}d.Clean();var g=this.data.join("");if(d.skew&&g.length!==1){delete d.skew}if(d.r>d.w&&g.length===1&&!f.noIC){d.ic=d.r-d.w;d.w=d.r}this.SVGhandleColor(d);this.SVGsaveData(d);this.EditableSVGelem=d.element;return d};b.prototype.SVGchildSVG=function(c){return(this.data[c]?this.data[c].toSVG():new BBOX())};b.prototype.EditableSVGdataStretched=function(d,c,e){if(e===void 0){e=null}this.EditableSVGdata={HW:c,D:e};if(!this.data[d]){return new BBOX()}if(e!=null){return this.data[d].SVGstretchV(c,e)}if(c!=null){return this.data[d].SVGstretchH(c)}return this.data[d].toSVG()};b.prototype.SVGsaveData=function(d){if(!this.EditableSVGdata){this.EditableSVGdata={}}this.EditableSVGdata.w=d.w,this.EditableSVGdata.x=d.x;this.EditableSVGdata.h=d.h,this.EditableSVGdata.d=d.d;if(d.y){this.EditableSVGdata.h+=d.y;this.EditableSVGdata.d-=d.y}if(d.X!=null){this.EditableSVGdata.X=d.X}if(d.tw!=null){this.EditableSVGdata.tw=d.tw}if(d.skew){this.EditableSVGdata.skew=d.skew}if(d.ic){this.EditableSVGdata.ic=d.ic}if(this["class"]){d.removeable=false;EditableSVG.Element(d.element,{"class":this["class"]})}if(this.id){d.removeable=false;EditableSVG.Element(d.element,{id:this.id})}if(this.href){var c=EditableSVG.Element("a",{"class":"mjx-svg-href"});c.setAttributeNS(Util.XLINKNS,"href",this.href);c.onclick=this.SVGlink;this.editableSVG.addElement(c,"rect",{width:d.w,height:d.h+d.d,y:-d.d,fill:"none",stroke:"none","pointer-events":"all"});if(d.type==="svg"){var f=d.element.firstChild;while(f.firstChild){c.appendChild(f.firstChild)}f.appendChild(c)}else{c.appendChild(d.element);d.element=c}d.removeable=false}if(EditableSVGConfig.config.addMMLclasses){this.SVGaddClass(d.element,"mjx-svg-"+this.type);d.removeable=false}var e=this.style;if(e&&d.element){d.element.style.cssText=e;if(d.element.style.fontSize){d.element.style.fontSize=""}d.element.style.border=d.element.style.padding="";if(d.removeable){d.removeable=(d.element.style.cssText==="")}}this.SVGaddAttributes(d)};b.prototype.SVGaddClass=function(e,c){var d=e.getAttribute("class");e.setAttribute("class",(d?d+" ":"")+c)};b.prototype.SVGaddAttributes=function(d){if(this.attrNames){var k=this.attrNames,f=this.MML.nocopyAttributes,j=this.HUB.config.ignoreMMLattributes;var g=(this.type==="mstyle"?this.MML.math.prototype.defaults:this.defaults);for(var e=0,c=k.length;e<c;e++){var h=k[e];if(j[h]==false||(!f[h]&&!j[h]&&g[h]==null&&typeof(d.element[h])==="undefined")){d.element.setAttribute(h,this.attr[h]);d.removeable=false}}}};b.prototype.SVGlink=function(){var c=this.href.animVal;if(c.charAt(0)==="#"){var d=Util.hashCheck(document.getElementById(c.substr(1)));if(d&&d.scrollIntoView){setTimeout(function(){d.parentNode.scrollIntoView(true)},1)}}document.location=c};b.prototype.SVGgetStyles=function(){if(this.style){var c=this.HTML.Element("span");c.style.cssText=this.style;this.styles=this.SVGprocessStyles(c.style)}};b.prototype.SVGprocessStyles=function(c){var d={border:Util.getBorders(c),padding:Util.getPadding(c)};if(!d.border){delete d.border}if(!d.padding){delete d.padding}if(c.fontSize){d.fontSize=c.fontSize}if(c.color){d.color=c.color}if(c.backgroundColor){d.background=c.backgroundColor}if(c.fontStyle){d.fontStyle=c.fontStyle}if(c.fontWeight){d.fontWeight=c.fontWeight}if(c.fontFamily){d.fontFamily=c.fontFamily}if(d.fontWeight&&d.fontWeight.match(/^\d+$/)){d.fontWeight=(parseInt(d.fontWeight)>600?"bold":"normal")}return d};b.prototype.SVGhandleSpace=function(f){if(this.useMMLspacing){if(this.type!=="mo"){return}var e=this.getValues("scriptlevel","lspace","rspace");if(e.scriptlevel<=0||this.hasValue("lspace")||this.hasValue("rspace")){var d=this.SVGgetMu(f);e.lspace=Math.max(0,Util.length2em(e.lspace,d));e.rspace=Math.max(0,Util.length2em(e.rspace,d));var c=this,g=this.Parent();while(g&&g.isEmbellished()&&g.Core()===c){c=g;g=g.Parent()}if(e.lspace){f.x+=e.lspace}if(e.rspace){f.X=e.rspace}}}else{var h=this.texSpacing();this.SVGgetScale();if(h!==""){f.x+=Util.length2em(h,this.scale)*this.mscale}}};b.prototype.SVGhandleColor=function(h){var q=this.getValues("mathcolor","color");if(this.styles&&this.styles.color&&!q.color){q.color=this.styles.color}if(q.color&&!this.mathcolor){q.mathcolor=q.color}if(q.mathcolor){EditableSVG.Element(h.element,{fill:q.mathcolor,stroke:q.mathcolor});h.removeable=false}var l=(this.styles||{}).border,o=(this.styles||{}).padding,m=((l||{}).left||0),j=((o||{}).left||0),c;q.background=(this.mathbackground||this.background||(this.styles||{}).background||this.MML.COLOR.TRANSPARENT);if(m+j){var d=new BBOX(this.HUB);for(c in h){if(h.hasOwnProperty(c)){d[c]=h[c]}}d.x=0;d.y=0;h.element=this.editableSVG.Element("g");h.removeable=true;h.Add(d,m+j,0)}if(o){h.w+=o.right||0;h.h+=o.top||0;h.d+=o.bottom||0}if(l){h.w+=l.right||0;h.h+=l.top||0;h.d+=l.bottom||0}if(q.background!==this.MML.COLOR.TRANSPARENT){var n=h.element.nodeName.toLowerCase();if(n!=="g"&&n!=="svg"){var i=this.editableSVG.Element("g");i.appendChild(h.element);h.element=i;h.removeable=true}h.Add(new BBOX_RECT(h.h,h.d,h.w,{fill:q.background,stroke:"none"}),0,0,false,true)}if(l){var p=5;var e={left:["V",h.h+h.d,-p,-h.d],right:["V",h.h+h.d,h.w-l.right+p,-h.d],top:["H",h.w,0,h.h-l.top+p],bottom:["H",h.w,0,-h.d-p]};for(c in e){if(e.hasOwnProperty(c)){if(l[c]){var k=e[c],f=BBOX[k[0]+"LINE"];h.Add(f(k[1],l[c],l[c+"Style"],l[c+"Color"]),k[2],k[3])}}}}};b.prototype.SVGhandleVariant=function(c,e,d){return EditableSVG.HandleVariant(c,e,d)};b.prototype.SVGgetVariant=function(){var c=this.getValues("mathvariant","fontfamily","fontweight","fontstyle");var d=c.mathvariant;if(this.variantForm){d="-TeX-variant"}c.hasVariant=this.Get("mathvariant",true);if(!c.hasVariant){c.family=c.fontfamily;c.weight=c.fontweight;c.style=c.fontstyle}if(this.styles){if(!c.style&&this.styles.fontStyle){c.style=this.styles.fontStyle}if(!c.weight&&this.styles.fontWeight){c.weight=this.styles.fontWeight}if(!c.family&&this.styles.fontFamily){c.family=this.styles.fontFamily}}if(c.family&&!c.hasVariant){if(!c.weight&&c.mathvariant.match(/bold/)){c.weight="bold"}if(!c.style&&c.mathvariant.match(/italic/)){c.style="italic"}d={forceFamily:true,font:{"font-family":c.family}};if(c.style){d.font["font-style"]=c.style}if(c.weight){d.font["font-weight"]=c.weight}return d}if(c.weight==="bold"){d={normal:this.MML.VARIANT.BOLD,italic:this.MML.VARIANT.BOLDITALIC,fraktur:this.MML.VARIANT.BOLDFRAKTUR,script:this.MML.VARIANT.BOLDSCRIPT,"sans-serif":this.MML.VARIANT.BOLDSANSSERIF,"sans-serif-italic":this.MML.VARIANT.SANSSERIFBOLDITALIC}[d]||d}else{if(c.weight==="normal"){d={bold:this.MML.VARIANT.normal,"bold-italic":this.MML.VARIANT.ITALIC,"bold-fraktur":this.MML.VARIANT.FRAKTUR,"bold-script":this.MML.VARIANT.SCRIPT,"bold-sans-serif":this.MML.VARIANT.SANSSERIF,"sans-serif-bold-italic":this.MML.VARIANT.SANSSERIFITALIC}[d]||d}}if(c.style==="italic"){d={normal:this.MML.VARIANT.ITALIC,bold:this.MML.VARIANT.BOLDITALIC,"sans-serif":this.MML.VARIANT.SANSSERIFITALIC,"bold-sans-serif":this.MML.VARIANT.SANSSERIFBOLDITALIC}[d]||d}else{if(c.style==="normal"){d={italic:this.MML.VARIANT.NORMAL,"bold-italic":this.MML.VARIANT.BOLD,"sans-serif-italic":this.MML.VARIANT.SANSSERIF,"sans-serif-bold-italic":this.MML.VARIANT.BOLDSANSSERIF}[d]||d}}if(!(d in EditableSVG.FONTDATA.VARIANT)){d="normal"}return EditableSVG.FONTDATA.VARIANT[d]};b.prototype.SVGgetScale=function(d){var e=1;if(this.mscale){e=this.scale}else{var c=this.getValues("scriptlevel","fontsize");c.mathsize=(this.isToken?this:this.Parent()).Get("mathsize");if((this.styles||{}).fontSize&&!c.fontsize){c.fontsize=this.styles.fontSize}if(c.fontsize&&!this.mathsize){c.mathsize=c.fontsize}if(c.scriptlevel!==0){if(c.scriptlevel>2){c.scriptlevel=2}e=Math.pow(this.Get("scriptsizemultiplier"),c.scriptlevel);c.scriptminsize=Util.length2em(this.Get("scriptminsize"))/1000;if(e<c.scriptminsize){e=c.scriptminsize}}this.scale=e;this.mscale=Util.length2em(c.mathsize)/1000}if(d){d.scale=e;if(this.isToken){d.scale*=this.mscale}}return e*this.mscale};b.prototype.SVGgetMu=function(e){var c=1,d=this.getValues("scriptlevel","scriptsizemultiplier");if(e.scale&&e.scale!==1){c=1/e.scale}if(d.scriptlevel!==0){if(d.scriptlevel>2){d.scriptlevel=2}c=Math.sqrt(Math.pow(d.scriptsizemultiplier,d.scriptlevel))}return c};b.prototype.SVGnotEmpty=function(c){while(c){if((c.type!=="mrow"&&c.type!=="texatom")||c.data.length>1){return true}c=c.data[0]}return false};b.prototype.SVGcanStretch=function(e){var d=false;if(this.isEmbellished()){var c=this.Core();if(c&&c!==this){d=c.SVGcanStretch(e);if(d&&c.forceStretch){this.forceStretch=true}}}return d};b.prototype.SVGstretchV=function(c,e){return this.toSVG(c,e)};b.prototype.SVGstretchH=function(c){return this.toSVG(c)};b.prototype.SVGlineBreaks=function(){return false};b.prototype.SVGautoload=function(){var c=this.editableSVG.autoloadDir+"/"+this.type+".js";this.HUB.RestartAfter(this.AJAX.Require(c))};b.prototype.SVGautoloadFile=function(c){var d=this.editableSVG.autoloadDir+"/"+c+".js";this.HUB.RestartAfter(this.AJAX.Require(d))};return b})(ElementJax);var CharsMixin=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}b.prototype.toSVG=function(e,h,d,f){var g=this.data.join("").replace(/[\u2061-\u2064]/g,"");if(d){g=d(g,f)}var c=this.SVGhandleVariant(e,h,g);this.EditableSVGelem=c.element;return c};return b})(MBaseMixin);var EntityMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(d,g,c,e){var f=this.toString().replace(/[\u2061-\u2064]/g,"");if(c){f=c(f,e)}console.log("handling entity: ",f);return this.SVGhandleVariant(d,g,f)};return a})(MBaseMixin);var MActionMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){return this.SVGautoload()};return a})(MBaseMixin);var MathMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(m,d){var o=EditableSVGConfig.config;if(this.data[0]){this.SVGgetStyles();this.MML.mbase.prototype.displayAlign=this.HUB.config.displayAlign;this.MML.mbase.prototype.displayIndent=this.HUB.config.displayIndent;if(String(this.HUB.config.displayIndent).match(/^0($|[a-z%])/i)){this.MML.mbase.prototype.displayIndent="0"}var i=new BBOX_G();i.Add(this.data[0].toSVG(),0,0,true);i.Clean();this.SVGhandleColor(i);this.editableSVG.Element(i.element,{stroke:"currentColor",fill:"currentColor","stroke-width":0,transform:"matrix(1 0 0 -1 0 0)"});i.removeable=false;var j=new BBOX_NONREMOVABLE();j.element.setAttribute("xmlns:xlink",Util.XLINKNS);if(o.useFontCache&&!o.useGlobalCache){j.element.appendChild(BBOX.defs)}j.Add(i);j.Clean();this.SVGsaveData(j);if(!m){j.element=j.element.firstChild;j.element.removeAttribute("transform");j.removeable=true;return j}var h=Math.max(-j.l,0),c=Math.max(j.r-j.w,0);var e=j.element.style;j.element.setAttribute("width",this.editableSVG.Ex(h+j.w+c));j.element.setAttribute("height",this.editableSVG.Ex(j.H+j.D+2*Util.em));e.verticalAlign=this.editableSVG.Ex(-j.D-2*this.editableSVG.em);e.marginLeft=this.editableSVG.Ex(-h);e.marginRight=this.editableSVG.Ex(-c);j.element.setAttribute("viewBox",this.editableSVG.Fixed(-h,1)+" "+this.editableSVG.Fixed(-j.H-Util.em,1)+" "+this.editableSVG.Fixed(h+j.w+c,1)+" "+this.editableSVG.Fixed(j.H+j.D+2*Util.em,1));e.marginTop=e.marginBottom="1px";if(j.H>j.h){e.marginTop=this.editableSVG.Ex(j.h-j.H)}if(j.D>j.d){e.marginBottom=this.editableSVG.Ex(j.d-j.D);e.verticalAlign=this.editableSVG.Ex(-j.d)}var k=this.Get("alttext");if(k&&!j.element.getAttribute("aria-label")){m.setAttribute("aria-label",k)}if(!j.element.getAttribute("role")){m.setAttribute("role","math")}m.appendChild(j.element);j.element=null;if(!this.isMultiline&&this.Get("display")==="block"&&!j.hasIndent){var n=this.getValues("indentalignfirst","indentshiftfirst","indentalign","indentshift");if(n.indentalignfirst!==this.MML.INDENTALIGN.INDENTALIGN){n.indentalign=n.indentalignfirst}if(n.indentalign===this.MML.INDENTALIGN.AUTO){n.indentalign=this.displayAlign}if(n.indentshiftfirst!==this.MML.INDENTSHIFT.INDENTSHIFT){n.indentshift=n.indentshiftfirst}if(n.indentshift==="auto"){n.indentshift="0"}var f=Util.length2em(n.indentshift,1,this.editableSVG.cwidth);if(this.displayIndent!=="0"){var g=Util.length2em(this.displayIndent,1,this.editableSVG.cwidth);f+=(n.indentalign===this.MML.INDENTALIGN.RIGHT?-g:g)}d.style.textAlign=n.indentalign;if(f){this.HUB.Insert(e,({left:{marginLeft:this.editableSVG.Ex(f)},right:{marginRight:this.editableSVG.Ex(-f)},center:{marginLeft:this.editableSVG.Ex(f),marginRight:this.editableSVG.Ex(-f)}})[n.indentalign])}}}return m};return a})(MBaseMixin);var MEncloseMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){return this.SVGautoload()};return a})(MBaseMixin);var MErrorMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(e,c){this.SVGgetStyles();var j=new BBOX(),g=Util.length2em(this.styles.fontSize||1)/1000;this.SVGhandleSpace(j);var d=(g!==1?{transform:"scale("+this.editableSVG.Fixed(g)+")"}:{});var l=new BBOX(d);l.Add(this.SVGchildSVG(0));l.Clean();if(g!==1){l.removeable=false;var k=["w","h","d","l","r","D","H"];for(var h=0,f=k.length;h<f;h++){l[k[h]]*=g}}j.Add(l);j.Clean();this.SVGhandleColor(j);this.SVGsaveData(j);return j};a.prototype.SVGgetStyles=function(){var c=this.HTML.Element("span",{style:EditableSVGConfig.config.merrorStyle});this.styles=this.SVGprocessStyles(c.style);if(this.style){c.style.cssText=this.style;this.HUB.Insert(this.styles,this.SVGprocessStyles(c.style))}};return a})(MBaseMixin);var MFencedMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){this.SVGgetStyles();var d=new BBOX_ROW(this.SVG,this.HUB);this.SVGhandleSpace(d);if(this.data.open){d.Check(this.data.open)}if(this.data[0]!=null){d.Check(this.data[0])}for(var e=1,c=this.data.length;e<c;e++){if(this.data[e]){if(this.data["sep"+e]){d.Check(this.data["sep"+e])}d.Check(this.data[e])}}if(this.data.close){d.Check(this.data.close)}d.Stretch();d.Clean();this.SVGhandleColor(d);this.SVGsaveData(d);return d};return a})(MBaseMixin);var MFracMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){this.SVGgetStyles();var l=new BBOX();var y=this.SVGgetScale(l);var e=new BBOX();e.scale=l.scale;this.SVGhandleSpace(e);var g=this.SVGchildSVG(0),f=this.SVGchildSVG(1);var c=this.getValues("displaystyle","linethickness","numalign","denomalign","bevelled");var r=c.displaystyle;var x=Util.TeX.axis_height*y;if(c.bevelled){var w=(r?400:150);var h=Math.max(g.h+g.d,f.h+f.d)+2*w;var s=EditableSVG.createDelimiter(47,h);e.Add(g,0,(g.d-g.h)/2+x+w);e.Add(s,g.w-w/2,(s.d-s.h)/2+x);e.Add(f,g.w+s.w-w,(f.d-f.h)/2+x-w)}else{var d=Math.max(g.w,f.w);var k=Util.thickness2em(c.linethickness,this.scale)*this.mscale,n,m,j,i;var o=Util.TeX.min_rule_thickness/Util.em*1000;if(r){j=Util.TeX.num1;i=Util.TeX.denom1}else{j=(k===0?Util.TeX.num3:Util.TeX.num2);i=Util.TeX.denom2}j*=y;i*=y;if(k===0){n=Math.max((r?7:3)*Util.TeX.rule_thickness,2*o);m=(j-g.d)-(f.h-i);if(m<n){j+=(n-m)/2;i+=(n-m)/2}e.w=d;k=0}else{n=Math.max((r?2:0)*o+k,k/2+1.5*o);m=(j-g.d)-(x+k/2);if(m<n){j+=n-m}m=(x-k/2)-(f.h-i);if(m<n){i+=n-m}e.Add(new BBOX_RECT(k/2,k/2,d+2*k),0,x)}e.Align(g,c.numalign,k,j);e.Align(f,c.denomalign,k,-i)}e.Clean();l.Add(e,0,0);l.Clean();this.SVGhandleColor(l);this.SVGsaveData(l);this.EditableSVGelem=l.element;return l};a.prototype.SVGcanStretch=function(c){return false};a.prototype.SVGhandleSpace=function(c){if(!this.texWithDelims&&!this.useMMLspacing){c.x=c.X=Util.TeX.nulldelimiterspace*this.mscale}b.prototype.SVGhandleSpace.call(this,c)};a.name="mfrac";return a})(MBaseMixin);var MGlyphMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){return this.SVGautoload()};return a})(MBaseMixin);var MMultiScriptsMixin=(function(){function a(){this.toSVG=MBaseMixin.SVGautoload}return a})();var MoMixin=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}b.prototype.toSVG=function(d,c){if(d===void 0){d=null}if(c===void 0){c=null}this.SVGgetStyles();var l=this.svg=new BBOX();var g=this.SVGgetScale(l);this.SVGhandleSpace(l);if(this.data.length==0){l.Clean();this.SVGsaveData(l);return l}if(c!=null){return this.SVGstretchV(d,c)}else{if(d!=null){return this.SVGstretchH(d)}}var j=this.SVGgetVariant();var r=this.getValues("largeop","displaystyle");if(r.largeop){j=EditableSVG.FONTDATA.VARIANT[r.displaystyle?"-largeOp":"-smallOp"]}var q=this.CoreParent();var h=(q&&q.isa(this.MML.msubsup)&&this!==q.data[0]);var e=(h?this.remapChars:null);if(this.data.join("").length===1&&q&&q.isa(this.MML.munderover)&&this.CoreText(q.data[q.base]).length===1){var n=q.data[q.over],p=q.data[q.under];if(n&&this===n.CoreMO()&&q.Get("accent")){e=EditableSVG.FONTDATA.REMAPACCENT}else{if(p&&this===p.CoreMO()&&q.Get("accentunder")){e=EditableSVG.FONTDATA.REMAPACCENTUNDER}}}if(h&&this.data.join("").match(/['`"\u00B4\u2032-\u2037\u2057]/)){j=EditableSVG.FONTDATA.VARIANT["-TeX-variant"]}for(var k=0,f=this.data.length;k<f;k++){if(this.data[k]){var s=this.data[k].toSVG(j,g,this.remap,e),o=l.w;if(o===0&&-s.l>10*s.w){o+=-s.l}l.Add(s,o,0,true);if(s.skew){l.skew=s.skew}}}l.Clean();if(this.data.join("").length!==1){delete l.skew}if(r.largeop){l.y=Util.TeX.axis_height-(l.h-l.d)/2/g;if(l.r>l.w){l.ic=l.r-l.w;l.w=l.r}}this.SVGhandleColor(l);this.SVGsaveData(l);this.EditableSVGelem=l.element;return l};b.prototype.SVGcanStretch=function(h){if(!this.Get("stretchy")){return false}var i=this.data.join("");if(i.length>1){return false}var e=this.CoreParent();if(e&&e.isa(this.MML.munderover)&&this.CoreText(e.data[e.base]).length===1){var g=e.data[e.over],d=e.data[e.under];if(g&&this===g.CoreMO()&&e.Get("accent")){i=EditableSVG.FONTDATA.REMAPACCENT[i]||i}else{if(d&&this===d.CoreMO()&&e.Get("accentunder")){i=EditableSVG.FONTDATA.REMAPACCENTUNDER[i]||i}}}i=EditableSVG.FONTDATA.DELIMITERS[i.charCodeAt(0)];var f=(i&&i.dir==h.substr(0,1));if(!f){delete this.svg}this.forceStretch=f&&(this.Get("minsize",true)||this.Get("maxsize",true));return f};b.prototype.SVGstretchV=function(j,k){var f=this.svg||this.toSVG();var e=this.getValues("symmetric","maxsize","minsize");var i=Util.TeX.axis_height*f.scale,c=this.SVGgetMu(f),g;if(e.symmetric){g=2*Math.max(j-i,k+i)}else{g=j+k}e.maxsize=Util.length2em(e.maxsize,c,f.h+f.d);e.minsize=Util.length2em(e.minsize,c,f.h+f.d);g=Math.max(e.minsize,Math.min(e.maxsize,g));if(g!=e.minsize){g=[Math.max(g*Util.TeX.delimiterfactor/1000,g-Util.TeX.delimitershortfall),g]}f=EditableSVG.createDelimiter(this.data.join("").charCodeAt(0),g,f.scale);if(e.symmetric){g=(f.h+f.d)/2+i}else{g=(f.h+f.d)*j/(j+k)}f.y=g-f.h;this.SVGhandleSpace(f);this.SVGhandleColor(f);delete this.svg.element;this.SVGsaveData(f);f.stretched=true;return f};b.prototype.SVGstretchH=function(d){var f=this.svg||this.toSVG(),c=this.SVGgetMu(f);var e=this.getValues("maxsize","minsize","mathvariant","fontweight");if((e.fontweight==="bold"||parseInt(e.fontweight)>=600)&&!this.Get("mathvariant",true)){e.mathvariant=this.MML.VARIANT.BOLD}e.maxsize=Util.length2em(e.maxsize,c,f.w);e.minsize=Util.length2em(e.minsize,c,f.w);d=Math.max(e.minsize,Math.min(e.maxsize,d));f=EditableSVG.createDelimiter(this.data.join("").charCodeAt(0),d,f.scale,e.mathvariant);this.SVGhandleSpace(f);this.SVGhandleColor(f);delete this.svg.element;this.SVGsaveData(f);f.stretched=true;return f};return b})(MBaseMixin);var MPaddedMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(g,c){this.SVGgetStyles();var k=new BBOX();if(this.data[0]!=null){this.SVGgetScale(k);this.SVGhandleSpace(k);var i=this.EditableSVGdataStretched(0,g,c),p=this.SVGgetMu(k);var o=this.getValues("height","depth","width","lspace","voffset"),f=0,e=0;if(o.lspace){f=this.editableSVG.SVGlength2em(i,o.lspace,p)}if(o.voffset){e=this.editableSVG.SVGlength2em(i,o.voffset,p)}var j=i.h,l=i.d,n=i.w,m=i.y;k.Add(i,f,e);k.Clean();k.h=j+m;k.d=l-m;k.w=n;k.removeable=false;if(o.height!==""){k.h=this.SVGlength2em(k,o.height,p,"h",0)}if(o.depth!==""){k.d=this.SVGlength2em(k,o.depth,p,"d",0)}if(o.width!==""){k.w=this.SVGlength2em(k,o.width,p,"w",0)}if(k.h>k.H){k.H=k.h}if(k.d>k.D){k.D=k.d}}this.SVGhandleColor(k);this.SVGsaveData(k);return k};a.prototype.SVGlength2em=function(g,j,e,k,c){if(c==null){c=-Util.BIGDIMEN}var h=String(j).match(/width|height|depth/);var i=(h?g[h[0].charAt(0)]:(k?g[k]:0));var f=Util.length2em(j,e,i/this.mscale)*this.mscale;if(k&&String(j).match(/^\s*[-+]/)){return Math.max(c,g[k]+f)}else{return f}};return a})(MBaseMixin);var MPhantomMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(c,e){this.SVGgetStyles();var d=new this.SVG();this.SVGgetScale(d);if(this.data[0]!=null){this.SVGhandleSpace(d);d.Add(this.EditableSVGdataStretched(0,c,e));d.Clean();while(d.element.firstChild){d.element.removeChild(d.element.firstChild)}}this.SVGhandleColor(d);this.SVGsaveData(d);if(d.removeable&&!d.element.firstChild){delete d.element}return d};return a})(MBaseMixin);var MSqrtMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){this.SVGgetStyles();var h=new BBOX();var f=this.SVGgetScale(h);this.SVGhandleSpace(h);var e=this.SVGchildSVG(0),i,g;var l=Util.TeX.rule_thickness*f,d,c,k,j=0;if(this.Get("displaystyle")){d=Util.TeX.x_height*f}else{d=l}c=Math.max(l+d/4,1000*Util.TeX.min_root_space/Util.em);k=e.h+e.d+c+l;g=EditableSVG.createDelimiter(8730,k,f);if(g.h+g.d>k){c=((g.h+g.d)-(k-l))/2}i=new BBOX_RECT(l,0,e.w);k=e.h+c+l;j=this.SVGaddRoot(h,g,j,g.h+g.d-k,f);h.Add(g,j,k-g.h);h.Add(i,j+g.w,k-i.h);h.Add(e,j+g.w,0);h.Clean();h.h+=l;h.H+=l;this.SVGhandleColor(h);this.SVGsaveData(h);return h};a.prototype.SVGaddRoot=function(e,f,c,h,g){return c};return a})(MBaseMixin);var MRootMixin=(function(a){__extends(b,a);function b(){a.apply(this,arguments);this.toSVG=MSqrtMixin.toSVG}b.prototype.SVGaddRoot=function(g,e,k,i,c){var m=(e.isMultiChar?0.55:0.65)*e.w;if(this.data[1]){var j=this.data[1].toSVG();j.x=0;var f=this.SVGrootHeight(e.h+e.d,c,j)-i;var l=Math.min(j.w,j.r);k=Math.max(l,m);g.Add(j,k-l,f)}else{m=k}return k-m};b.prototype.SVGrootHeight=function(f,e,c){return 0.45*(f-900*e)+600*e+Math.max(0,c.d-75)};return b})(MBaseMixin);var MRowMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.focus=function(){console.log("focus!")};a.prototype.toSVG=function(g,k){this.SVGgetStyles();var e=new BBOX_ROW(this.editableSVG);this.SVGhandleSpace(e);if(k!=null){e.sh=g;e.sd=k}for(var f=0,c=this.data.length;f<c;f++){if(this.data[f]){e.Check(this.data[f])}}e.Stretch();e.Clean();if(this.data.length===1&&this.data[0]){var j=this.data[0].EditableSVGdata;if(j.skew){e.skew=j.skew}}if(this.SVGlineBreaks(e)){e=this.SVGmultiline(e)}this.SVGhandleColor(e);this.SVGsaveData(e);this.EditableSVGelem=e.element;return e};a.prototype.SVGlineBreaks=function(c){if(!this.parent.linebreakContainer){return false}return(EditableSVGConfig.config.linebreaks.automatic&&c.w>this.editableSVG.linebreakWidth)||this.hasNewline()};a.prototype.SVGmultiline=function(c){return this.MML.mbase.SVGautoloadFile("multiline")};a.prototype.SVGstretchH=function(d){var e=new BBOX_ROW(this.editableSVG);this.SVGhandleSpace(e);for(var f=0,c=this.data.length;f<c;f++){e.Add(this.EditableSVGdataStretched(f,d),e.w,0)}e.Clean();this.SVGhandleColor(e);this.SVGsaveData(e);return e};return a})(MBaseMixin);var MsMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments);this.toSVG=MBaseMixin.SVGautoload}return a})(MBaseMixin);var MSpaceMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){this.SVGgetStyles();var e=this.getValues("height","depth","width");e.mathbackground=this.mathbackground;if(this.background&&!this.mathbackground){e.mathbackground=this.background}var d=new BBOX();this.SVGgetScale(d);var f=this.mscale,c=this.SVGgetMu(d);d.h=Util.length2em(e.height,c)*f;d.d=Util.length2em(e.depth,c)*f;d.w=d.r=Util.length2em(e.width,c)*f;if(d.w<0){d.x=d.w;d.w=d.r=0}if(d.h<-d.d){d.d=-d.h}d.l=0;d.Clean();this.SVGhandleColor(d);this.SVGsaveData(d);return d};return a})(MBaseMixin);var MStyleMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){this.SVGgetStyles();var c=new BBOX();if(this.data[0]!=null){this.SVGhandleSpace(c);var d=c.Add(this.data[0].toSVG());c.Clean();if(d.ic){c.ic=d.ic}this.SVGhandleColor(c)}this.SVGsaveData(c);return c};a.prototype.SVGstretchH=function(c){return(this.data[0]!=null?this.data[0].SVGstretchH(c):new BBOX_NULL())};a.prototype.SVGstretchV=function(c,e){return(this.data[0]!=null?this.data[0].SVGstretchV(c,e):new BBOX_NULL())};return a})(MBaseMixin);var MSubSupMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(A,m){this.SVGgetStyles();var o=new BBOX(),F=this.SVGgetScale(o);this.SVGhandleSpace(o);var y=this.SVGgetMu(o);var f=o.Add(this.EditableSVGdataStretched(this.base,A,m));var e=(this.data[this.sup]||this.data[this.sub]||this).SVGgetScale();var C=Util.TeX.x_height*F,l=Util.TeX.scriptspace*F;var c,g;if(this.SVGnotEmpty(this.data[this.sup])){c=this.data[this.sup].toSVG();c.w+=l;c.r=Math.max(c.w,c.r)}if(this.SVGnotEmpty(this.data[this.sub])){g=this.data[this.sub].toSVG();g.w+=l;g.r=Math.max(g.w,g.r)}var w=Util.TeX.sup_drop*e,n=Util.TeX.sub_drop*e;var j=f.h+(f.y||0)-w,i=f.d-(f.y||0)+n,E=0,z;if(f.ic){f.w-=f.ic;E=1.3*f.ic+0.05}if(this.data[this.base]&&(this.data[this.base].type==="mi"||this.data[this.base].type==="mo")){if(this.data[this.base].data.join("").length===1&&f.scale===1&&!f.stretched&&!this.data[this.base].Get("largeop")){j=i=0}}var B=this.getValues("subscriptshift","superscriptshift");B.subscriptshift=(B.subscriptshift===""?0:Util.length2em(B.subscriptshift,y));B.superscriptshift=(B.superscriptshift===""?0:Util.length2em(B.superscriptshift,y));var h=f.w+f.x;if(!c){if(g){i=Math.max(i,Util.TeX.sub1*F,g.h-(4/5)*C,B.subscriptshift);o.Add(g,h,-i);this.data[this.sub].EditableSVGdata.dy=-i}}else{if(!g){var d=this.getValues("displaystyle","texprimestyle");z=Util.TeX[(d.displaystyle?"sup1":(d.texprimestyle?"sup3":"sup2"))];j=Math.max(j,z*F,c.d+(1/4)*C,B.superscriptshift);o.Add(c,h+E,j);this.data[this.sup].EditableSVGdata.dx=E;this.data[this.sup].EditableSVGdata.dy=j}else{i=Math.max(i,Util.TeX.sub2*F);var k=Util.TeX.rule_thickness*F;if((j-c.d)-(g.h-i)<3*k){i=3*k-j+c.d+g.h;w=(4/5)*C-(j-c.d);if(w>0){j+=w;i-=w}}o.Add(c,h+E,Math.max(j,B.superscriptshift));o.Add(g,h,-Math.max(i,B.subscriptshift));this.data[this.sup].EditableSVGdata.dx=E;this.data[this.sup].EditableSVGdata.dy=Math.max(j,B.superscriptshift);this.data[this.sub].EditableSVGdata.dy=-Math.max(i,B.subscriptshift)}}o.Clean();this.SVGhandleColor(o);this.SVGsaveData(o);return o};return a})(MBaseMixin);var MTableMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments);this.toSVG=MBaseMixin.SVGautoload}return a})(MBaseMixin);var MTextMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(){if(EditableSVGConfig.config.mtextFontInherit||this.Parent().type==="merror"){this.SVGgetStyles();var c=new BBOX();var f=this.SVGgetScale(c);this.SVGhandleSpace(c);var d=this.SVGgetVariant();var e={direction:this.Get("dir")};if(d.bold){e["font-weight"]="bold"}if(d.italic){e["font-style"]="italic"}d=this.Get("mathvariant");if(d==="monospace"){e["class"]="MJX-monospace"}else{if(d.match(/sans-serif/)){e["class"]="MJX-sans-serif"}}c.Add(new BBOX_TEXT(this.HTML,f*100/EditableSVGConfig.config.scale,this.data.join(""),e));c.Clean();this.SVGhandleColor(c);this.SVGsaveData(c);return c}else{return b.prototype.toSVG.call(this)}};return a})(MBaseMixin);var MUnderOverMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(v,s){this.SVGgetStyles();var c=this.getValues("displaystyle","accent","accentunder","align");if(!c.displaystyle&&this.data[this.base]!=null&&this.data[this.base].CoreMO().Get("movablelimits")){return this.MML.msubsup.prototype.toSVG.call(this)}var u=new BBOX();var F=this.SVGgetScale(u);this.SVGhandleSpace(u);var f=[],C=[],l,B,w,d=-Util.BIGDIMEN,A=d;for(B=0,w=this.data.length;B<w;B++){if(this.data[B]!=null){if(B==this.base){f[B]=this.EditableSVGdataStretched(B,v,s);C[B]=(s!=null||v==null)&&this.data[B].SVGcanStretch("Horizontal")}else{f[B]=this.data[B].toSVG();f[B].x=0;delete f[B].X;C[B]=this.data[B].SVGcanStretch("Horizontal")}if(f[B].w>A){A=f[B].w}if(!C[B]&&A>d){d=A}}}if(s==null&&v!=null){d=v}else{if(d==-Util.BIGDIMEN){d=A}}for(B=A=0,w=this.data.length;B<w;B++){if(this.data[B]){if(C[B]){f[B]=this.data[B].SVGstretchH(d);if(B!==this.base){f[B].x=0;delete f[B].X}}if(f[B].w>A){A=f[B].w}}}var r=Util.TeX.rule_thickness*this.mscale;var e=f[this.base]||{w:0,h:0,d:0,H:0,D:0,l:0,r:0,y:0,scale:F};var j,g,o,n,h,q,z,E=0;if(e.ic){E=1.3*e.ic+0.05}for(B=0,w=this.data.length;B<w;B++){if(this.data[B]!=null){l=f[B];h=Util.TeX.big_op_spacing5*F;var p=(B!=this.base&&c[this.ACCENTS[B]]);if(p&&l.w<=1){l.x=-l.l;f[B]=(new BBOX_G()).With({removeable:false},this.HUB);f[B].Add(l);f[B].Clean();f[B].w=-l.l;l=f[B]}q={left:0,center:(A-l.w)/2,right:A-l.w}[c.align];j=q;g=0;if(B==this.over){if(p){z=r*F;h=0;if(e.skew){j+=e.skew;u.skew=e.skew;if(j+l.w>A){u.skew+=(A-l.w-j)/2}}}else{o=Util.TeX.big_op_spacing1*F;n=Util.TeX.big_op_spacing3*F;z=Math.max(o,n-Math.max(0,l.d))}z=Math.max(z,1500/Util.em);j+=E/2;g=e.y+e.h+l.d+z;l.h+=h;if(l.h>l.H){l.H=l.h}}else{if(B==this.under){if(p){z=3*r*F;h=0}else{o=Util.TeX.big_op_spacing2*F;n=Util.TeX.big_op_spacing4*F;z=Math.max(o,n-l.h)}z=Math.max(z,1500/Util.em);j-=E/2;g=e.y-(e.d+l.h+z);l.d+=h;if(l.d>l.D){l.D=l.d}}}u.Add(l,j,g)}}u.Clean();this.SVGhandleColor(u);this.SVGsaveData(u);return u};return a})(MBaseMixin);var SemanticsMixin=(function(a){__extends(b,a);function b(){a.apply(this,arguments)}b.prototype.toSVG=function(){this.SVGgetStyles();var c=new BBOX();if(this.data[0]!=null){this.SVGhandleSpace(c);c.Add(this.data[0].toSVG());c.Clean()}else{c.Clean()}this.SVGsaveData(c);return c};b.prototype.SVGstretchH=function(c){return(this.data[0]!=null?this.data[0].SVGstretchH(c):new BBOX_NULL())};b.prototype.SVGstretchV=function(c,e){return(this.data[0]!=null?this.data[0].SVGstretchV(c,e):new BBOX_NULL())};return b})(MBaseMixin);var TeXAtomMixin=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.toSVG=function(c,f){this.SVGgetStyles();var d=new BBOX();this.SVGhandleSpace(d);if(this.data[0]!=null){var e=this.EditableSVGdataStretched(0,c,f),g=0;if(this.texClass===this.MML.TEXCLASS.VCENTER){g=Util.TeX.axis_height-(e.h+e.d)/2+e.d}d.Add(e,0,g);d.ic=e.ic;d.skew=e.skew}this.SVGhandleColor(d);this.SVGsaveData(d);return d};return a})(MBaseMixin);
